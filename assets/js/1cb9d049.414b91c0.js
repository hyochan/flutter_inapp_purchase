"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[6933],{6852:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>d,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"migration/from-v8","title":"Migration from v8.1","description":"This guide helps you migrate from flutterinapppurchase v8.1.x to v8.2.0.","source":"@site/docs/migration/from-v8.md","sourceDirName":"migration","slug":"/migration/from-v8","permalink":"/flutter_inapp_purchase/migration/from-v8","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/docs/migration/from-v8.md","tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"sidebar_position":0}}');var s=r(74848),a=r(28453),t=r(35159);const d={sidebar_position:0},l="Migration from v8.1",c={},o=[{value:"Breaking Changes",id:"breaking-changes",level:2},{value:"PurchaseState Enum Simplified",id:"purchasestate-enum-simplified",level:3},{value:"Deprecations",id:"deprecations",level:2},{value:"AlternativeBillingModeAndroid Deprecated",id:"alternativebillingmodeandroid-deprecated",level:3},{value:"useAlternativeBilling Deprecated",id:"usealternativebilling-deprecated",level:3},{value:"New Features",id:"new-features",level:2},{value:"BillingProgramAndroid.UserChoiceBilling",id:"billingprogramandroiduserchoicebilling",level:3},{value:"Dependencies Update",id:"dependencies-update",level:2},{value:"References",id:"references",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"migration-from-v81",children:"Migration from v8.1"})}),"\n",(0,s.jsx)(t.A,{}),"\n",(0,s.jsx)(n.p,{children:"This guide helps you migrate from flutter_inapp_purchase v8.1.x to v8.2.0."}),"\n",(0,s.jsx)(n.h2,{id:"breaking-changes",children:"Breaking Changes"}),"\n",(0,s.jsx)(n.h3,{id:"purchasestate-enum-simplified",children:"PurchaseState Enum Simplified"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"PurchaseState"})," enum has been simplified by removing unused states. This is a breaking change if you're explicitly handling these states."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Before (v8.1.x):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"enum PurchaseState {\n  Pending,\n  Purchased,\n  Failed,      // REMOVED\n  Restored,    // REMOVED\n  Deferred,    // REMOVED\n  Unknown,\n}\n\n// Example: handling purchase states\nswitch (purchase.purchaseState) {\n  case PurchaseState.Purchased:\n    // Grant entitlement\n    break;\n  case PurchaseState.Failed:\n    // Handle failure - NO LONGER VALID\n    break;\n  case PurchaseState.Restored:\n    // Handle restore - NO LONGER VALID\n    break;\n  case PurchaseState.Deferred:\n    // Handle pending approval - NO LONGER VALID\n    break;\n  case PurchaseState.Pending:\n  case PurchaseState.Unknown:\n    // Handle pending/unknown\n    break;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"After (v8.2.0):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"enum PurchaseState {\n  Pending,\n  Purchased,\n  Unknown,\n}\n\n// Example: handling purchase states\nswitch (purchase.purchaseState) {\n  case PurchaseState.Purchased:\n    // Grant entitlement (includes restored purchases)\n    break;\n  case PurchaseState.Pending:\n    // Purchase is pending (includes deferred on Android)\n    break;\n  case PurchaseState.Unknown:\n    // Unknown state - handle appropriately\n    break;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Why were these states removed?"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Removed State"}),(0,s.jsx)(n.th,{children:"Reason"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Failed"})}),(0,s.jsxs)(n.td,{children:["Both platforms return errors instead of Purchase objects on failure. Use ",(0,s.jsx)(n.code,{children:"purchaseErrorListener"})," instead."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Restored"})}),(0,s.jsxs)(n.td,{children:["Restored purchases now return as ",(0,s.jsx)(n.code,{children:"Purchased"})," state."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Deferred"})}),(0,s.jsxs)(n.td,{children:["iOS StoreKit 2 has no transaction state; Android uses ",(0,s.jsx)(n.code,{children:"Pending"}),"."]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Migration steps:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Remove any ",(0,s.jsx)(n.code,{children:"case PurchaseState.Failed:"}),", ",(0,s.jsx)(n.code,{children:"case PurchaseState.Restored:"}),", and ",(0,s.jsx)(n.code,{children:"case PurchaseState.Deferred:"})," from switch statements"]}),"\n",(0,s.jsxs)(n.li,{children:["For failure handling, use ",(0,s.jsx)(n.code,{children:"purchaseErrorListener"}),":","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"iap.purchaseErrorListener.listen((error) {\n  print('Purchase failed: ${error.message}');\n});\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Restored purchases will come through as ",(0,s.jsx)(n.code,{children:"PurchaseState.Purchased"})]}),"\n",(0,s.jsxs)(n.li,{children:["Deferred purchases will come through as ",(0,s.jsx)(n.code,{children:"PurchaseState.Pending"})," on Android"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"deprecations",children:"Deprecations"}),"\n",(0,s.jsx)(n.h3,{id:"alternativebillingmodeandroid-deprecated",children:"AlternativeBillingModeAndroid Deprecated"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"AlternativeBillingModeAndroid"})," is deprecated in favor of the unified ",(0,s.jsx)(n.code,{children:"BillingProgramAndroid"})," enum."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Before (deprecated):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"await iap.initConnection(\n  alternativeBillingModeAndroid: AlternativeBillingModeAndroid.UserChoice,\n);\n\n// or\nawait iap.initConnection(\n  alternativeBillingModeAndroid: AlternativeBillingModeAndroid.AlternativeOnly,\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"After (recommended):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"await iap.initConnection(\n  enableBillingProgramAndroid: BillingProgramAndroid.UserChoiceBilling,\n);\n\n// or\nawait iap.initConnection(\n  enableBillingProgramAndroid: BillingProgramAndroid.ExternalOffer,\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Migration mapping:"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Deprecated"}),(0,s.jsx)(n.th,{children:"Recommended"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AlternativeBillingModeAndroid.UserChoice"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BillingProgramAndroid.UserChoiceBilling"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AlternativeBillingModeAndroid.AlternativeOnly"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BillingProgramAndroid.ExternalOffer"})})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"usealternativebilling-deprecated",children:"useAlternativeBilling Deprecated"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"RequestPurchaseProps.useAlternativeBilling"})," is deprecated. It only logged debug info and had no effect on purchase flow."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Before (deprecated):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"await iap.requestPurchase(\n  RequestPurchaseProps.inApp((\n    apple: RequestPurchaseIosProps(sku: 'product_id'),\n    useAlternativeBilling: true,  // DEPRECATED - no effect\n  )),\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"After (recommended):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"// For iOS external purchases, use presentExternalPurchaseLinkIOS\nfinal result = await iap.presentExternalPurchaseLinkIOS(\n  'https://your-site.com/checkout',\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"new-features",children:"New Features"}),"\n",(0,s.jsx)(n.h3,{id:"billingprogramandroiduserchoicebilling",children:"BillingProgramAndroid.UserChoiceBilling"}),"\n",(0,s.jsxs)(n.p,{children:["A new enum value has been added to ",(0,s.jsx)(n.code,{children:"BillingProgramAndroid"})," for User Choice Billing:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"enum BillingProgramAndroid {\n  Unspecified,\n  UserChoiceBilling,     // NEW in v8.2.0\n  ExternalContentLink,\n  ExternalOffer,\n  ExternalPayments,\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This allows you to check User Choice Billing availability:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final availability = await iap.isBillingProgramAvailableAndroid(\n  BillingProgramAndroid.UserChoiceBilling,\n);\n\nif (availability.isAvailable) {\n  // User Choice Billing is available\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"dependencies-update",children:"Dependencies Update"}),"\n",(0,s.jsxs)(n.p,{children:["Update your ",(0,s.jsx)(n.code,{children:"pubspec.yaml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"dependencies:\n  flutter_inapp_purchase: ^8.2.0\n"})}),"\n",(0,s.jsx)(n.p,{children:"The plugin automatically uses:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"openiap-apple"}),": 1.3.9"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"openiap-google"}),": 1.3.21"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"openiap-gql"}),": 1.3.11"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developer.android.com/reference/com/android/billingclient/api/Purchase.PurchaseState",children:"Google Play Billing - Purchase.PurchaseState"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developer.apple.com/documentation/storekit/product/purchaseresult",children:"Apple StoreKit 2 - Product.PurchaseResult"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developer.apple.com/documentation/storekit/skpaymenttransactionstate",children:"Apple StoreKit 1 - SKPaymentTransactionState (Deprecated)"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},27856:(e,n,r)=>{r.d(n,{I:()=>s,V:()=>i});const i="https://iapkit.com",s="https://www.hyo.dev/api/ad-banner/cmjf0l1x30001249hbi91aop6"},28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>d});var i=r(96540);const s={},a=i.createContext(s);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(a.Provider,{value:n},e.children)}},35159:(e,n,r)=>{r.d(n,{A:()=>a});r(96540);var i=r(27856),s=r(74848);function a({style:e}){return(0,s.jsx)("div",{style:{marginTop:24,marginBottom:24,textAlign:"center",...e},children:(0,s.jsx)("a",{href:i.V,target:"_blank",rel:"noopener noreferrer",onClick:async()=>{try{await fetch(i.I,{method:"POST",mode:"no-cors"})}catch(e){}},children:(0,s.jsx)("img",{src:r(65860).A,alt:"IapKit - Fraud-proof your in-app purchases",style:{objectFit:"cover",border:"none"}})})})}},65860:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/iapkit-banner-c71d8c3f875ca90b812e7b54822795d2.gif"}}]);