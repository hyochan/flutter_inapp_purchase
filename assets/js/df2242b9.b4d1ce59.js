"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[792],{27856:(e,s,n)=>{n.d(s,{I:()=>i,V:()=>r});const r="https://iapkit.com",i="https://www.hyo.dev/api/ad-banner/cmjf0l1x30001249hbi91aop6"},28453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>t});var r=n(96540);const i={},a=r.createContext(i);function c(e){const s=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(a.Provider,{value:s},e.children)}},35159:(e,s,n)=>{n.d(s,{A:()=>a});n(96540);var r=n(27856),i=n(74848);function a({style:e}){return(0,i.jsx)("div",{style:{marginTop:24,marginBottom:24,textAlign:"center",...e},children:(0,i.jsx)("a",{href:r.V,target:"_blank",rel:"noopener noreferrer",onClick:async()=>{try{await fetch(r.I,{method:"POST",mode:"no-cors"})}catch(e){}},children:(0,i.jsx)("img",{src:n(65860).A,alt:"IapKit - Fraud-proof your in-app purchases",style:{objectFit:"cover",border:"none"}})})})}},65860:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/iapkit-banner-c71d8c3f875ca90b812e7b54822795d2.gif"},81172:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"guides/purchases","title":"Purchases","description":"Complete guide to implementing in-app purchases with flutterinapppurchase v7.0.","source":"@site/versioned_docs/version-8.0/guides/purchases.md","sourceDirName":"guides","slug":"/guides/purchases","permalink":"/flutter_inapp_purchase/8.0/guides/purchases","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/versioned_docs/version-8.0/guides/purchases.md","tags":[],"version":"8.0","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Purchases"},"sidebar":"docsSidebar","previous":{"title":"Horizon OS","permalink":"/flutter_inapp_purchase/8.0/getting-started/setup-horizon"},"next":{"title":"Purchase Lifecycle","permalink":"/flutter_inapp_purchase/8.0/guides/lifecycle"}}');var i=n(74848),a=n(28453),c=n(35159);const t={sidebar_position:1,title:"Purchases"},l="Purchases",o={},d=[{value:"Purchase Flow",id:"purchase-flow",level:2},{value:"Initialize Connection",id:"initialize-connection",level:2},{value:"Setup Purchase Listeners",id:"setup-purchase-listeners",level:2},{value:"Load Products",id:"load-products",level:2},{value:"Request Purchase",id:"request-purchase",level:2},{value:"Handle Purchase",id:"handle-purchase",level:2},{value:"Product Types",id:"product-types",level:2},{value:"Consumable Products",id:"consumable-products",level:3},{value:"Non-Consumable Products",id:"non-consumable-products",level:3},{value:"Subscriptions",id:"subscriptions",level:3},{value:"Restore Purchases",id:"restore-purchases",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Next Steps",id:"next-steps",level:2}];function u(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"purchases",children:"Purchases"})}),"\n",(0,i.jsx)(c.A,{}),"\n",(0,i.jsx)(s.p,{children:"Complete guide to implementing in-app purchases with flutter_inapp_purchase v7.0."}),"\n",(0,i.jsx)(s.h2,{id:"purchase-flow",children:"Purchase Flow"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Initialize Connection"})," - Connect to the store"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Setup Listeners"})," - Handle purchase updates and errors"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Load Products"})," - Fetch available products"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Request Purchase"})," - Initiate purchase"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Deliver Content"})," - Provide purchased content"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Finish Transaction"})," - Complete the transaction"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"initialize-connection",children:"Initialize Connection"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-dart",children:"final iap = FlutterInappPurchase.instance;\nawait iap.initConnection();\n"})}),"\n",(0,i.jsx)(s.h2,{id:"setup-purchase-listeners",children:"Setup Purchase Listeners"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-dart",children:"StreamSubscription<Purchase>? _purchaseUpdatedSubscription;\nStreamSubscription<PurchaseError>? _purchaseErrorSubscription;\n\nvoid setupListeners() {\n  _purchaseUpdatedSubscription = iap.purchaseUpdatedListener.listen(\n    (purchase) {\n      debugPrint('Purchase received: ${purchase.productId}');\n      _handlePurchase(purchase);\n    },\n  );\n\n  _purchaseErrorSubscription = iap.purchaseErrorListener.listen(\n    (error) {\n      debugPrint('Purchase error: ${error.message}');\n      _handleError(error);\n    },\n  );\n}\n\n@override\nvoid dispose() {\n  _purchaseUpdatedSubscription?.cancel();\n  _purchaseErrorSubscription?.cancel();\n  super.dispose();\n}\n"})}),"\n",(0,i.jsx)(s.h2,{id:"load-products",children:"Load Products"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-dart",children:"final products = await iap.fetchProducts(\n  skus: ['product_id_1', 'product_id_2'],\n  type: ProductQueryType.inApp,\n);\n\nfor (final product in products) {\n  print('${product.title}: ${product.displayPrice}');\n}\n"})}),"\n",(0,i.jsx)(s.h2,{id:"request-purchase",children:"Request Purchase"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-dart",children:"await iap.requestPurchase(\n  sku: 'product_id',\n  obfuscatedAccountIdAndroid: userId,\n  obfuscatedProfileIdAndroid: profileId,\n);\n"})}),"\n",(0,i.jsx)(s.h2,{id:"handle-purchase",children:"Handle Purchase"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-dart",children:"Future<void> _handlePurchase(Purchase purchase) async {\n  // 1. Validate purchase on your server (required for production)\n  final isValid = await verifyPurchaseOnServer(purchase);\n  if (!isValid) return;\n\n  // 2. Deliver content to user\n  await deliverContent(purchase.productId);\n\n  // 3. Finish transaction\n  await iap.finishTransaction(\n    purchase: purchase,\n    isConsumable: true, // or false for non-consumables/subscriptions\n  );\n}\n"})}),"\n",(0,i.jsx)(s.h2,{id:"product-types",children:"Product Types"}),"\n",(0,i.jsx)(s.h3,{id:"consumable-products",children:"Consumable Products"}),"\n",(0,i.jsx)(s.p,{children:"Products that can be purchased multiple times (coins, gems):"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-dart",children:"await iap.finishTransaction(\n  purchase: purchase,\n  isConsumable: true, // Consumes on Android, finishes on iOS\n);\n"})}),"\n",(0,i.jsx)(s.h3,{id:"non-consumable-products",children:"Non-Consumable Products"}),"\n",(0,i.jsx)(s.p,{children:"One-time purchases (premium features, ad removal):"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-dart",children:"await iap.finishTransaction(\n  purchase: purchase,\n  isConsumable: false, // Acknowledges on Android, finishes on iOS\n);\n"})}),"\n",(0,i.jsx)(s.h3,{id:"subscriptions",children:"Subscriptions"}),"\n",(0,i.jsxs)(s.p,{children:["Recurring purchases - see ",(0,i.jsx)(s.a,{href:"./subscription-offers",children:"Subscription Offers"})]}),"\n",(0,i.jsx)(s.h2,{id:"restore-purchases",children:"Restore Purchases"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-dart",children:"// Restore previous purchases\nawait iap.restorePurchases();\n\n// Get available purchases\nfinal purchases = await iap.getAvailablePurchases();\n\nfor (final purchase in purchases) {\n  await deliverContent(purchase.productId);\n}\n"})}),"\n",(0,i.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Always set up listeners first"})," before making purchase requests"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Validate purchases server-side"})," for security"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsxs)(s.strong,{children:["Use correct ",(0,i.jsx)(s.code,{children:"isConsumable"})," flag"]})," - it handles consume/acknowledge automatically"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Handle errors gracefully"})," - see ",(0,i.jsx)(s.a,{href:"./error-handling",children:"Error Handling"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Test thoroughly"})," in sandbox environments"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,i.jsxs)(s.p,{children:["See working implementations in ",(0,i.jsx)(s.a,{href:"../examples/purchase-flow",children:"Examples"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"./lifecycle",children:"Purchase Lifecycle"})," - Understand the full lifecycle"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"./subscription-offers",children:"Subscription Offers"})," - Handle subscriptions"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"./error-handling",children:"Error Handling"})," - Handle purchase errors"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}}}]);