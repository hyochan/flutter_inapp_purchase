"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[2868],{5554:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>t,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"examples/available-purchases","title":"Available Purchases","description":"Source Code: availablepurchasesscreen.dart","source":"@site/docs/examples/available-purchases.md","sourceDirName":"examples","slug":"/examples/available-purchases","permalink":"/flutter_inapp_purchase/docs/examples/available-purchases","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/docs/examples/available-purchases.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Subscription Flow","permalink":"/flutter_inapp_purchase/docs/examples/subscription-flow"},"next":{"title":"Offer Code Redemption","permalink":"/flutter_inapp_purchase/docs/examples/offer-code"}}');var a=r(4848),i=r(8453);const l={sidebar_position:3},c="Available Purchases",t={},d=[{value:"Key Features",id:"key-features",level:2},{value:"Implementation Overview",id:"implementation-overview",level:2},{value:"1. Get Active Purchases",id:"1-get-active-purchases",level:3},{value:"2. Get All Purchases (Including Expired)",id:"2-get-all-purchases-including-expired",level:3},{value:"3. Display Purchase Information",id:"3-display-purchase-information",level:3},{value:"4. Restore Purchases",id:"4-restore-purchases",level:3},{value:"Platform Differences",id:"platform-differences",level:2},{value:"iOS",id:"ios",level:3},{value:"Android",id:"android",level:3},{value:"Best Practices",id:"best-practices",level:2}];function o(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"available-purchases",children:"Available Purchases"})}),"\n",(0,a.jsxs)(s.blockquote,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Source Code"}),": ",(0,a.jsx)(s.a,{href:"https://github.com/hyochan/flutter_inapp_purchase/blob/main/example/lib/src/screens/available_purchases_screen.dart",children:"available_purchases_screen.dart"})]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"This example demonstrates how to retrieve and display user's available purchases and purchase history."}),"\n",(0,a.jsx)(s.h2,{id:"key-features",children:"Key Features"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Retrieve active purchases"}),"\n",(0,a.jsx)(s.li,{children:"Include expired subscriptions (iOS)"}),"\n",(0,a.jsx)(s.li,{children:"Display purchase details"}),"\n",(0,a.jsx)(s.li,{children:"Restore purchases"}),"\n",(0,a.jsx)(s.li,{children:"Handle purchase validation"}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"implementation-overview",children:"Implementation Overview"}),"\n",(0,a.jsx)(s.h3,{id:"1-get-active-purchases",children:"1. Get Active Purchases"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-dart",children:"final purchases = await iap.getAvailablePurchases(\n  onlyIncludeActiveItemsIOS: true,\n);\n"})}),"\n",(0,a.jsx)(s.h3,{id:"2-get-all-purchases-including-expired",children:"2. Get All Purchases (Including Expired)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-dart",children:"final allPurchases = await iap.getAvailablePurchases(\n  onlyIncludeActiveItemsIOS: false,\n  alsoPublishToEventListenerIOS: false,\n);\n"})}),"\n",(0,a.jsx)(s.h3,{id:"3-display-purchase-information",children:"3. Display Purchase Information"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-dart",children:"for (final purchase in purchases) {\n  debugPrint('Product ID: ${purchase.productId}');\n  debugPrint('Transaction ID: ${purchase.transactionIdFor}');\n  debugPrint('Purchase Date: ${purchase.transactionDate}');\n  debugPrint('Purchase Token: ${purchase.purchaseToken}');\n}\n"})}),"\n",(0,a.jsx)(s.h3,{id:"4-restore-purchases",children:"4. Restore Purchases"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-dart",children:"Future<void> restorePurchases() async {\n  final restored = await iap.getAvailablePurchases();\n\n  // Verify purchases on server\n  for (final purchase in restored) {\n    await verifyPurchaseOnServer(purchase.purchaseToken);\n  }\n\n  // Grant access to purchased content\n  await updateUserAccess(restored);\n}\n"})}),"\n",(0,a.jsx)(s.h2,{id:"platform-differences",children:"Platform Differences"}),"\n",(0,a.jsx)(s.h3,{id:"ios",children:"iOS"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Use ",(0,a.jsx)(s.code,{children:"onlyIncludeActiveItemsIOS: true"})," to filter expired subscriptions"]}),"\n",(0,a.jsxs)(s.li,{children:["Use ",(0,a.jsx)(s.code,{children:"onlyIncludeActiveItemsIOS: false"})," to include purchase history"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"alsoPublishToEventListenerIOS"})," publishes purchases to the event stream"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"android",children:"Android"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Returns all verified purchases from Google Play"}),"\n",(0,a.jsx)(s.li,{children:"Includes purchase tokens for server-side verification"}),"\n",(0,a.jsx)(s.li,{children:"No separate purchase history API"}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Verify purchases on your backend"})," - Don't trust client-side purchase data alone"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Handle restore gracefully"})," - Show clear feedback during restore process"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Check purchase state"})," - Validate purchase state before granting access"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Support offline mode"})," - Cache validated purchases locally"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Handle edge cases"})," - Account for refunds, cancellations, and billing retries"]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>l,x:()=>c});var n=r(6540);const a={},i=n.createContext(a);function l(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);