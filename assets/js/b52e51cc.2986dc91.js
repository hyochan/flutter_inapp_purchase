"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[4239],{28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>c});var s=r(96540);const i={},a=s.createContext(i);function t(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:n},e.children)}},83788:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"api/classes/purchase-item","title":"Purchase","description":"Represents an item that was purchased from either the Google Play Store or iOS App Store.","source":"@site/versioned_docs/version-6.8/api/classes/purchase-item.md","sourceDirName":"api/classes","slug":"/api/classes/purchase-item","permalink":"/flutter_inapp_purchase/6.8/api/classes/purchase-item","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/versioned_docs/version-6.8/api/classes/purchase-item.md","tags":[],"version":"6.8","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Purchase"}}');var i=r(74848),a=r(28453);const t={sidebar_position:3,title:"Purchase"},c="Purchase Class",o={},d=[{value:"Overview",id:"overview",level:2},{value:"Properties",id:"properties",level:2},{value:"Common Properties",id:"common-properties",level:3},{value:"Android-Specific Properties",id:"android-specific-properties",level:3},{value:"iOS-Specific Properties",id:"ios-specific-properties",level:3},{value:"Methods",id:"methods",level:2},{value:"fromJSON()",id:"fromjson",level:3},{value:"toString()",id:"tostring",level:3},{value:"Enums",id:"enums",level:2},{value:"PurchaseState (Android)",id:"purchasestate-android",level:3},{value:"TransactionState (iOS)",id:"transactionstate-ios",level:3},{value:"Usage Example",id:"usage-example",level:2},{value:"Receipt Validation",id:"receipt-validation",level:2},{value:"Platform Differences",id:"platform-differences",level:2},{value:"iOS",id:"ios",level:3},{value:"Android",id:"android",level:3},{value:"Important Notes",id:"important-notes",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"purchase-class",children:"Purchase Class"})}),"\n",(0,i.jsx)(n.p,{children:"Represents an item that was purchased from either the Google Play Store or iOS App Store."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Purchase"})," class contains all the information about a completed or pending purchase transaction. This includes transaction identifiers, receipts, purchase states, and platform-specific details."]}),"\n",(0,i.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,i.jsx)(n.h3,{id:"common-properties",children:"Common Properties"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final String productId\n"})}),"\n",(0,i.jsx)(n.p,{children:"The product identifier (SKU) of the purchase."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final String? transactionId\n"})}),"\n",(0,i.jsx)(n.p,{children:"The unique transaction identifier."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final int? transactionDate\n"})}),"\n",(0,i.jsx)(n.p,{children:"The time when the transaction occurred (Unix timestamp in milliseconds)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final String? transactionReceipt\n"})}),"\n",(0,i.jsx)(n.p,{children:"The receipt data for the transaction (primarily used on iOS)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final String? purchaseToken\n"})}),"\n",(0,i.jsx)(n.p,{children:"The purchase token (primarily used on Android)."}),"\n",(0,i.jsx)(n.h3,{id:"android-specific-properties",children:"Android-Specific Properties"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final String? dataAndroid\n"})}),"\n",(0,i.jsx)(n.p,{children:"The original purchase data from Google Play."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final String? signatureAndroid\n"})}),"\n",(0,i.jsx)(n.p,{children:"The signature for purchase verification on Android."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final bool? autoRenewingAndroid\n"})}),"\n",(0,i.jsx)(n.p,{children:"Whether the subscription is set to auto-renew."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final bool? isAcknowledgedAndroid\n"})}),"\n",(0,i.jsx)(n.p,{children:"Whether the purchase has been acknowledged (Android requires acknowledgment within 3 days)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final PurchaseState? purchaseStateAndroid\n"})}),"\n",(0,i.jsx)(n.p,{children:"The current state of the purchase on Android."}),"\n",(0,i.jsx)(n.h3,{id:"ios-specific-properties",children:"iOS-Specific Properties"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final String? originalTransactionDateIOS\n"})}),"\n",(0,i.jsx)(n.p,{children:"The original transaction date (string) for restored purchases."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final String? originalTransactionIdentifierIOS\n"})}),"\n",(0,i.jsx)(n.p,{children:"The identifier of the original transaction (for restored purchases)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final TransactionState? transactionStateIOS\n"})}),"\n",(0,i.jsx)(n.p,{children:"The current state of the transaction on iOS."}),"\n",(0,i.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,i.jsx)(n.h3,{id:"fromjson",children:"fromJSON()"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Purchase.fromJSON(Map<String, dynamic> json)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Creates a ",(0,i.jsx)(n.code,{children:"Purchase"})," instance from a JSON map."]}),"\n",(0,i.jsx)(n.h3,{id:"tostring",children:"toString()"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"String toString()\n"})}),"\n",(0,i.jsx)(n.p,{children:"Returns a string representation with all properties. Transaction dates are formatted in ISO 8601 format."}),"\n",(0,i.jsx)(n.h2,{id:"enums",children:"Enums"}),"\n",(0,i.jsx)(n.h3,{id:"purchasestate-android",children:"PurchaseState (Android)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"enum PurchaseState {\n  pending,    // Purchase is pending\n  purchased,  // Purchase is completed\n  unspecified // Unknown state\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"transactionstate-ios",children:"TransactionState (iOS)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"enum TransactionState {\n  purchasing, // Transaction is being processed\n  purchased,  // Transaction is completed\n  failed,     // Transaction failed\n  restored,   // Transaction was restored\n  deferred    // Transaction is pending external action\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Listen to purchase updates\nFlutterInappPurchase.purchaseUpdated.listen((Purchase? purchase) async {\n  if (purchase != null) {\n    print('Product purchased: ${purchase.productId}');\n    print('Transaction ID: ${purchase.transactionId}');\n    print('Transaction Date: ${purchase.transactionDate}');\n\n    // Platform-specific handling\n    if (Platform.isIOS) {\n      // Check iOS transaction state\n      if (purchase.transactionStateIOS == TransactionState.purchased) {\n        // Finish the transaction\n        await FlutterInappPurchase.instance.finishTransaction(purchase);\n      }\n    } else if (Platform.isAndroid) {\n      // Check if acknowledgment is needed\n      if (purchase.isAcknowledgedAndroid == false) {\n        await FlutterInappPurchase.instance.acknowledgePurchaseAndroid(\n          purchaseToken: purchase.purchaseToken!\n        );\n      }\n    }\n  }\n});\n\n// Get purchase history\nList<Purchase> history = await FlutterInappPurchase.instance.getPurchaseHistory();\nif (history != null) {\n  for (var purchase in history) {\n    print('Previous purchase: ${purchase.productId}');\n    print('Purchase date: ${purchase.transactionDate}');\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"receipt-validation",children:"Receipt Validation"}),"\n",(0,i.jsx)(n.p,{children:"For receipt validation, use the appropriate properties:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"iOS:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"if (Platform.isIOS && purchase.transactionReceipt != null) {\n  final response = await FlutterInappPurchase.instance.validateReceiptIos(\n    receiptBody: {\n      'receipt-data': purchase.transactionReceipt!,\n      'password': 'your-shared-secret',\n    },\n    isTest: true, // Use sandbox for testing\n  );\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Android:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"if (Platform.isAndroid && purchase.purchaseToken != null) {\n  final response = await FlutterInappPurchase.instance.validateReceiptAndroid(\n    packageName: 'com.example.app',\n    productId: purchase.productId,\n    productToken: purchase.purchaseToken!,\n    accessToken: 'your-access-token',\n    isSubscription: false,\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"platform-differences",children:"Platform Differences"}),"\n",(0,i.jsx)(n.h3,{id:"ios",children:"iOS"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Uses ",(0,i.jsx)(n.code,{children:"transactionReceipt"})," for validation"]}),"\n",(0,i.jsxs)(n.li,{children:["Has ",(0,i.jsx)(n.code,{children:"transactionStateIOS"})," to track transaction lifecycle"]}),"\n",(0,i.jsx)(n.li,{children:"Supports restored purchases with original transaction information"}),"\n",(0,i.jsxs)(n.li,{children:["Must call ",(0,i.jsx)(n.code,{children:"finishTransaction()"})," to complete the purchase"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"android",children:"Android"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Uses ",(0,i.jsx)(n.code,{children:"purchaseToken"})," for validation"]}),"\n",(0,i.jsxs)(n.li,{children:["Requires acknowledgment within 3 days via ",(0,i.jsx)(n.code,{children:"acknowledgePurchaseAndroid()"})]}),"\n",(0,i.jsxs)(n.li,{children:["Has ",(0,i.jsx)(n.code,{children:"purchaseStateAndroid"})," to track purchase state"]}),"\n",(0,i.jsxs)(n.li,{children:["Consumable items must be consumed via ",(0,i.jsx)(n.code,{children:"consumePurchaseAndroid()"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Transaction Completion"}),": Always finish/acknowledge transactions to remove them from the queue"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Receipt Storage"}),": Store receipts securely for validation and restoration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Date Handling"}),": Transaction dates are automatically converted from milliseconds since epoch"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Null Safety"}),": Most properties are nullable as not all platforms provide all information"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);