"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[6152],{27856:(e,n,i)=>{i.d(n,{I:()=>a,V:()=>r});const r="https://iapkit.com",a="https://www.hyo.dev/api/ad-banner/cmjf0l1x30001249hbi91aop6"},28453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>o});var r=i(96540);const a={},s=r.createContext(a);function d(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),r.createElement(s.Provider,{value:n},e.children)}},35159:(e,n,i)=>{i.d(n,{A:()=>s});i(96540);var r=i(27856),a=i(74848);function s({style:e}){return(0,a.jsx)("div",{style:{marginTop:24,marginBottom:24,textAlign:"center",...e},children:(0,a.jsx)("a",{href:r.V,target:"_blank",rel:"noopener noreferrer",onClick:async()=>{try{await fetch(r.I,{method:"POST",mode:"no-cors"})}catch(e){}},children:(0,a.jsx)("img",{src:i(65860).A,alt:"IapKit - Fraud-proof your in-app purchases",style:{objectFit:"cover",border:"none"}})})})}},65860:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/iapkit-banner-c71d8c3f875ca90b812e7b54822795d2.gif"},69980:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"migration/from-v7","title":"Migration from v7","description":"This guide helps you migrate from flutterinapppurchase v7.x to v8.0.","source":"@site/versioned_docs/version-8.1/migration/from-v7.md","sourceDirName":"migration","slug":"/migration/from-v7","permalink":"/flutter_inapp_purchase/8.1/migration/from-v7","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/versioned_docs/version-8.1/migration/from-v7.md","tags":[],"version":"8.1","sidebarPosition":0,"frontMatter":{"sidebar_position":0},"sidebar":"docsSidebar","previous":{"title":"Support","permalink":"/flutter_inapp_purchase/8.1/guides/support"},"next":{"title":"Migrating from v6 to v7","permalink":"/flutter_inapp_purchase/8.1/migration/from-v6"}}');var a=i(74848),s=i(28453),d=i(35159);const o={sidebar_position:0},l="Migration from v7",t={},c=[{value:"Breaking Changes",id:"breaking-changes",level:2},{value:"<code>oneTimePurchaseOfferDetailsAndroid</code> is now an array",id:"onetimepurchaseofferdetailsandroid-is-now-an-array",level:3},{value:"<code>verifyPurchase</code> API changed",id:"verifypurchase-api-changed",level:3},{value:"Deprecated APIs",id:"deprecated-apis",level:2},{value:"Alternative Billing APIs",id:"alternative-billing-apis",level:3},{value:"New Features",id:"new-features",level:2},{value:"Billing Programs API",id:"billing-programs-api",level:3},{value:"One-Time Product Discount Fields",id:"one-time-product-discount-fields",level:3},{value:"Purchase Suspension Status",id:"purchase-suspension-status",level:3},{value:"Advanced Commerce Data (v8.1.0+)",id:"advanced-commerce-data-v810",level:3},{value:"Promoted Products (v8.1.0+)",id:"promoted-products-v810",level:3},{value:"<code>google</code> Field Support (v8.1.0+)",id:"google-field-support-v810",level:3},{value:"Dependencies Update",id:"dependencies-update",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"migration-from-v7",children:"Migration from v7"})}),"\n",(0,a.jsx)(d.A,{}),"\n",(0,a.jsx)(n.p,{children:"This guide helps you migrate from flutter_inapp_purchase v7.x to v8.0."}),"\n",(0,a.jsx)(n.h2,{id:"breaking-changes",children:"Breaking Changes"}),"\n",(0,a.jsxs)(n.h3,{id:"onetimepurchaseofferdetailsandroid-is-now-an-array",children:[(0,a.jsx)(n.code,{children:"oneTimePurchaseOfferDetailsAndroid"})," is now an array"]}),"\n",(0,a.jsxs)(n.p,{children:["The most significant breaking change is that ",(0,a.jsx)(n.code,{children:"oneTimePurchaseOfferDetailsAndroid"})," changed from a single object to an array. This was necessary to support multiple discount offers per product (Google Play Billing 7.0+)."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Before (v7.x):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"final price = product.oneTimePurchaseOfferDetailsAndroid?.formattedPrice;\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"After (v8.x):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"final offers = product.oneTimePurchaseOfferDetailsAndroid;\nfinal price = offers?.isNotEmpty == true ? offers![0].formattedPrice : null;\n\n// Or iterate through all offers\nfor (final offer in offers ?? []) {\n  print('Offer: ${offer.offerId ?? \"default\"}');\n  print('Price: ${offer.formattedPrice}');\n\n  // Check for discount info\n  if (offer.discountDisplayInfo != null) {\n    print('Discount: ${offer.discountDisplayInfo!.percentageDiscount}% off');\n  }\n}\n"})}),"\n",(0,a.jsxs)(n.h3,{id:"verifypurchase-api-changed",children:[(0,a.jsx)(n.code,{children:"verifyPurchase"})," API changed"]}),"\n",(0,a.jsxs)(n.p,{children:["The verification APIs now use platform-specific options objects instead of the deprecated ",(0,a.jsx)(n.code,{children:"sku"})," and ",(0,a.jsx)(n.code,{children:"androidOptions"})," parameters."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Before (v7.x):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"// iOS\nfinal result = await iap.verifyPurchase(sku: 'product_id');\n\n// Android\nfinal result = await iap.verifyPurchase(\n  sku: 'product_id',\n  androidOptions: VerifyPurchaseAndroidOptions(\n    accessToken: 'token',\n    packageName: 'com.your.app',\n    productToken: 'purchase_token',\n  ),\n);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"After (v8.x):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"// iOS - use apple options\nfinal result = await iap.verifyPurchase(\n  apple: VerifyPurchaseAppleOptions(sku: 'product_id'),\n);\n\n// Android - use google options\nfinal result = await iap.verifyPurchase(\n  google: VerifyPurchaseGoogleOptions(\n    sku: 'product_id',\n    accessToken: 'your-oauth-token',  // From your backend\n    packageName: 'com.your.app',\n    purchaseToken: purchase.purchaseToken,\n  ),\n);\n\n// Meta Horizon (Quest) - use horizon options\nfinal result = await iap.verifyPurchase(\n  horizon: VerifyPurchaseHorizonOptions(\n    sku: 'product_id',\n    accessToken: 'your-meta-token',\n    userId: 'user_id',\n  ),\n);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Note: The same change applies to ",(0,a.jsx)(n.code,{children:"validateReceipt"})," and ",(0,a.jsx)(n.code,{children:"validateReceiptIOS"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"deprecated-apis",children:"Deprecated APIs"}),"\n",(0,a.jsx)(n.h3,{id:"alternative-billing-apis",children:"Alternative Billing APIs"}),"\n",(0,a.jsx)(n.p,{children:"The Alternative Billing APIs are deprecated in favor of the new Billing Programs API:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Deprecated"}),(0,a.jsx)(n.th,{children:"Replacement"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"checkAlternativeBillingAvailabilityAndroid()"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"isBillingProgramAvailableAndroid(BillingProgramAndroid.ExternalOffer)"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"showAlternativeBillingDialogAndroid()"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"launchExternalLinkAndroid()"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"createAlternativeBillingTokenAndroid()"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"createBillingProgramReportingDetailsAndroid(BillingProgramAndroid.ExternalOffer)"})})]})]})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Before (v7.x):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"final available = await iap.checkAlternativeBillingAvailabilityAndroid();\nif (available) {\n  await iap.showAlternativeBillingDialogAndroid();\n  final token = await iap.createAlternativeBillingTokenAndroid();\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"After (v8.x):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"final result = await iap.isBillingProgramAvailableAndroid(\n  BillingProgramAndroid.ExternalOffer,\n);\n\nif (result.isAvailable) {\n  await iap.launchExternalLinkAndroid(\n    LaunchExternalLinkParamsAndroid(\n      billingProgram: BillingProgramAndroid.ExternalOffer,\n      launchMode: ExternalLinkLaunchModeAndroid.LaunchInExternalBrowserOrApp,\n      linkType: ExternalLinkTypeAndroid.LinkToDigitalContentOffer,\n      linkUri: 'https://your-payment-site.com/purchase',\n    ),\n  );\n\n  final details = await iap.createBillingProgramReportingDetailsAndroid(\n    BillingProgramAndroid.ExternalOffer,\n  );\n  // Use details.externalTransactionToken\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"new-features",children:"New Features"}),"\n",(0,a.jsx)(n.h3,{id:"billing-programs-api",children:"Billing Programs API"}),"\n",(0,a.jsx)(n.p,{children:"The new Billing Programs API provides three methods:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"isBillingProgramAvailableAndroid(program)"})," - Check if a billing program is available"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"launchExternalLinkAndroid(params)"})," - Launch external link for billing programs"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"createBillingProgramReportingDetailsAndroid(program)"})," - Get external transaction token"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.a,{href:"/docs/guides/alternative-billing",children:"Billing Programs Guide"})," for detailed usage."]}),"\n",(0,a.jsx)(n.h3,{id:"one-time-product-discount-fields",children:"One-Time Product Discount Fields"}),"\n",(0,a.jsxs)(n.p,{children:["New fields are available in ",(0,a.jsx)(n.code,{children:"ProductAndroidOneTimePurchaseOfferDetail"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"offerId"})," - Unique offer identifier"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"fullPriceMicros"})," - Full (non-discounted) price"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"discountDisplayInfo"})," - Contains ",(0,a.jsx)(n.code,{children:"percentageDiscount"})," and ",(0,a.jsx)(n.code,{children:"discountAmount"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"limitedQuantityInfo"})," - Maximum and remaining quantity"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"validTimeWindow"})," - Offer start and end times"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"offerTags"})," - List of tags for the offer"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"offerToken"})," - Token for purchase requests"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"preorderDetailsAndroid"})," - Pre-order release dates (Android 8.0+)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"rentalDetailsAndroid"})," - Rental period info (Android 8.0+)"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"purchase-suspension-status",children:"Purchase Suspension Status"}),"\n",(0,a.jsx)(n.p,{children:"Check if a subscription is suspended due to payment issues:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"final purchases = await iap.getAvailablePurchases();\n\nfor (final purchase in purchases) {\n  if (purchase is PurchaseAndroid && purchase.isSuspendedAndroid == true) {\n    // Do NOT grant entitlements for suspended subscriptions\n    // Direct user to fix payment method\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"advanced-commerce-data-v810",children:"Advanced Commerce Data (v8.1.0+)"}),"\n",(0,a.jsx)(n.p,{children:"New support for StoreKit 2's attribution data API on iOS 15+:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await iap.requestPurchaseWithBuilder(\n  build: (builder) {\n    builder.ios.sku = 'com.example.premium';\n    builder.ios.advancedCommerceData = 'campaign_summer_2025';\n    builder.type = ProductQueryType.InApp;\n  },\n);\n"})}),"\n",(0,a.jsx)(n.p,{children:"Use cases:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Campaign attribution tracking"}),"\n",(0,a.jsx)(n.li,{children:"Affiliate marketing integration"}),"\n",(0,a.jsx)(n.li,{children:"Promotional code tracking"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"promoted-products-v810",children:"Promoted Products (v8.1.0+)"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"requestPurchaseOnPromotedProductIOS()"})," is now deprecated. Use the ",(0,a.jsx)(n.code,{children:"purchasePromoted"})," stream instead:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Before (deprecated):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await iap.requestPurchaseOnPromotedProductIOS();\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"After (recommended):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"iap.purchasePromoted.listen((productId) async {\n  if (productId != null) {\n    await iap.requestPurchaseWithBuilder(\n      build: (builder) {\n        builder.ios.sku = productId;\n        builder.type = ProductQueryType.InApp;\n      },\n    );\n  }\n});\n"})}),"\n",(0,a.jsxs)(n.h3,{id:"google-field-support-v810",children:[(0,a.jsx)(n.code,{children:"google"})," Field Support (v8.1.0+)"]}),"\n",(0,a.jsxs)(n.p,{children:["Android request parameters now support the ",(0,a.jsx)(n.code,{children:"google"})," field (recommended) alongside the deprecated ",(0,a.jsx)(n.code,{children:"android"})," field:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"// types.dart - RequestPurchasePropsByPlatforms\nRequestPurchasePropsByPlatforms(\n  google: RequestPurchaseAndroidProps(skus: ['sku']),  // Recommended\n  // android: ...  // Deprecated\n);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"dependencies-update",children:"Dependencies Update"}),"\n",(0,a.jsxs)(n.p,{children:["Update your ",(0,a.jsx)(n.code,{children:"pubspec.yaml"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"dependencies:\n  flutter_inapp_purchase: ^8.1.0\n"})}),"\n",(0,a.jsx)(n.p,{children:"The plugin automatically uses:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"openiap-apple"}),": 1.3.7"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"openiap-google"}),": 1.3.16"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"openiap-gql"}),": 1.3.8"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}}}]);