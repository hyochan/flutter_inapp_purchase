"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[7797],{2480:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"migration/from-v5","title":"Migration from v5.x","description":"This guide helps you migrate from flutterinapppurchase v5.x to the latest v7.0+ version.","source":"@site/docs/migration/from-v5.md","sourceDirName":"migration","slug":"/migration/from-v5","permalink":"/flutter_inapp_purchase/docs/migration/from-v5","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/docs/migration/from-v5.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Migration from v5.x"},"sidebar":"docsSidebar","previous":{"title":"Migrating from v6 to v7","permalink":"/flutter_inapp_purchase/docs/migration/from-v6"},"next":{"title":"API Reference","permalink":"/flutter_inapp_purchase/docs/api/"}}');var i=r(4848),t=r(8453);const a={sidebar_position:2,title:"Migration from v5.x"},d="Migration from v5.x to v7.0+",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Installation",id:"installation",level:2},{value:"Key Changes Summary",id:"key-changes-summary",level:2},{value:"Major Breaking Changes",id:"major-breaking-changes",level:2},{value:"1. Error Code Format (CRITICAL)",id:"1-error-code-format-critical",level:3},{value:"2. Data Models",id:"2-data-models",level:3},{value:"3. fetchProducts API",id:"3-fetchproducts-api",level:3},{value:"4. requestPurchase API",id:"4-requestpurchase-api",level:3},{value:"5. finishTransaction API",id:"5-finishtransaction-api",level:3},{value:"6. Stream Access",id:"6-stream-access",level:3},{value:"7. Android Methods",id:"7-android-methods",level:3},{value:"Step-by-Step Migration",id:"step-by-step-migration",level:2},{value:"Step 1: Update Dependencies",id:"step-1-update-dependencies",level:3},{value:"Step 2: Update Error Code Handling",id:"step-2-update-error-code-handling",level:3},{value:"Step 3: Update Stream Listeners",id:"step-3-update-stream-listeners",level:3},{value:"Step 4: Update Product Fetching",id:"step-4-update-product-fetching",level:3},{value:"Step 5: Update Purchase Requests",id:"step-5-update-purchase-requests",level:3},{value:"Step 6: Update Transaction Completion",id:"step-6-update-transaction-completion",level:3},{value:"Step 7: Update Field Access",id:"step-7-update-field-access",level:3},{value:"Complete Migration Example",id:"complete-migration-example",level:2},{value:"Before (v5.x)",id:"before-v5x",level:3},{value:"After (v6.8+)",id:"after-v68",level:3},{value:"Testing Checklist",id:"testing-checklist",level:2},{value:"Common Migration Issues",id:"common-migration-issues",level:2},{value:"Issue 1: &quot;ErrorCode.E_USER_CANCELLED not found&quot;",id:"issue-1-errorcodee_user_cancelled-not-found",level:3},{value:"Issue 2: &quot;productId doesn&#39;t exist&quot;",id:"issue-2-productid-doesnt-exist",level:3},{value:"Issue 3: &quot;localizedPrice doesn&#39;t exist&quot;",id:"issue-3-localizedprice-doesnt-exist",level:3},{value:"Issue 4: &quot;type argument required&quot;",id:"issue-4-type-argument-required",level:3},{value:"Benefits of v6.8+",id:"benefits-of-v68",level:2},{value:"Need Help?",id:"need-help",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"migration-from-v5x-to-v70",children:"Migration from v5.x to v7.0+"})}),"\n",(0,i.jsx)(n.p,{children:"This guide helps you migrate from flutter_inapp_purchase v5.x to the latest v7.0+ version."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Version 7.0+ is a ",(0,i.jsx)(n.strong,{children:"major update"})," with significant breaking changes to align with the OpenIAP specification and support modern platform APIs."]}),"\n",(0,i.jsxs)(n.admonition,{title:"Migration Path",type:"tip",children:[(0,i.jsx)(n.p,{children:"If you're migrating from v5.x, we recommend:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"First migrate to v6.8 following this guide"}),"\n",(0,i.jsxs)(n.li,{children:["Then migrate from v6.8 to v7.0 using the ",(0,i.jsx)(n.a,{href:"./from-v6",children:"v6 to v7 migration guide"})]}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsxs)(n.p,{children:["Update your ",(0,i.jsx)(n.code,{children:"pubspec.yaml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"dependencies:\n  flutter_inapp_purchase: ^7.0.0\n"})}),"\n",(0,i.jsx)(n.h2,{id:"key-changes-summary",children:"Key Changes Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"OpenIAP Compliance"})," - Full alignment with OpenIAP specification"]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"StoreKit 2 Support"})," for iOS 15.0+"]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Billing Client v8"})," for Android"]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Improved Type Safety"})," with refined APIs"]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Better Error Handling"})," with standardized error codes"]}),"\n",(0,i.jsxs)(n.li,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"Breaking Changes"})," in error codes, method signatures, and data models"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"major-breaking-changes",children:"Major Breaking Changes"}),"\n",(0,i.jsx)(n.h3,{id:"1-error-code-format-critical",children:"1. Error Code Format (CRITICAL)"}),"\n",(0,i.jsx)(n.p,{children:"The most significant breaking change is the error code enum format."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v5.x (Old):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// SCREAMING_SNAKE_CASE with E_ prefix\nErrorCode.E_USER_CANCELLED\nErrorCode.E_NETWORK_ERROR\nErrorCode.E_ITEM_UNAVAILABLE\nErrorCode.E_ALREADY_OWNED\nErrorCode.E_DEVELOPER_ERROR\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v6.8+ (New):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// PascalCase format (OpenIAP standard)\nErrorCode.UserCancelled\nErrorCode.NetworkError\nErrorCode.ItemUnavailable\nErrorCode.AlreadyOwned\nErrorCode.DeveloperError\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Migration:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Before\nif (error.code == ErrorCode.E_USER_CANCELLED) { ... }\n\n// After\nif (error.code == ErrorCode.UserCancelled) { ... }\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-data-models",children:"2. Data Models"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v5.x:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"IAPItem"})," for products"]}),"\n",(0,i.jsx)(n.li,{children:"String-based product IDs"}),"\n",(0,i.jsx)(n.li,{children:"Nullable fields everywhere"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v6.8+:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Product"})," / ",(0,i.jsx)(n.code,{children:"ProductCommon"})," for products"]}),"\n",(0,i.jsx)(n.li,{children:"Strongly typed with required fields"}),"\n",(0,i.jsx)(n.li,{children:"Better null safety"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Before (v5.x)\nclass IAPItem {\n  String? productId;\n  String? price;\n  String? currency;\n  String? localizedPrice;\n}\n\n// After (v6.8+)\nclass Product {\n  String id;              // Required\n  double? price;          // Numeric\n  String currency;        // Required\n  String displayPrice;    // Required (localized)\n  ProductType type;       // Required\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-fetchproducts-api",children:"3. fetchProducts API"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v5.x:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Old approach\nList<IAPItem> items = await FlutterInappPurchase.instance\n    .fetchProducts(skus: _productIds, type: 'inapp');\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v6.8+:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// New OpenIAP-compliant approach\nfinal result = await FlutterInappPurchase.instance.fetchProducts(\n  ProductRequest(\n    skus: _productIds,\n    type: ProductQueryType.InApp,\n  ),\n);\nfinal products = result.value;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-requestpurchase-api",children:"4. requestPurchase API"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v5.x:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Simple string-based request\nString msg = await FlutterInappPurchase.instance\n    .requestPurchase(item.productId);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v6.8+:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Structured request with platform-specific options\nfinal requestProps = RequestPurchaseProps.inApp(\n  request: RequestPurchasePropsByPlatforms(\n    ios: RequestPurchaseIosProps(\n      sku: productId,\n      quantity: 1,\n    ),\n    android: RequestPurchaseAndroidProps(\n      skus: [productId],\n    ),\n  ),\n);\n\nawait FlutterInappPurchase.instance.requestPurchase(requestProps);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5-finishtransaction-api",children:"5. finishTransaction API"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v5.x:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// iOS only, simple call\nawait FlutterInappPurchase.instance.finishTransaction(item);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v6.8+:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Cross-platform with explicit consumable flag\nawait FlutterInappPurchase.instance.finishTransaction(\n  purchase: item,\n  isConsumable: true, // Required parameter\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"6-stream-access",children:"6. Stream Access"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v5.x:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Direct static stream access\nFlutterInappPurchase.iapUpdated.listen(...);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v6.8+:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Instance-based stream access\nFlutterInappPurchase.instance.purchaseUpdated.listen(...);\nFlutterInappPurchase.instance.purchaseError.listen(...);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"7-android-methods",children:"7. Android Methods"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v5.x:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"await FlutterInappPurchase.instance.consumePurchase(\n  purchaseToken: token,\n);\nawait FlutterInappPurchase.instance.acknowledgePurchase(\n  purchaseToken: token,\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"v6.8+:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Explicit Android suffix for clarity\nawait FlutterInappPurchase.instance.consumePurchaseAndroid(\n  purchaseToken: token,\n);\nawait FlutterInappPurchase.instance.acknowledgePurchaseAndroid(\n  purchaseToken: token,\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-by-step-migration",children:"Step-by-Step Migration"}),"\n",(0,i.jsx)(n.h3,{id:"step-1-update-dependencies",children:"Step 1: Update Dependencies"}),"\n",(0,i.jsxs)(n.p,{children:["Update your ",(0,i.jsx)(n.code,{children:"pubspec.yaml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"dependencies:\n  flutter_inapp_purchase: ^6.8.0\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"flutter pub get\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-update-error-code-handling",children:"Step 2: Update Error Code Handling"}),"\n",(0,i.jsx)(n.p,{children:"Find and replace all error code references:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Search for:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"ErrorCode.E_USER_CANCELLED\nErrorCode.E_NETWORK_ERROR\nErrorCode.E_ITEM_UNAVAILABLE\nErrorCode.E_ALREADY_OWNED\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Replace with:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"ErrorCode.UserCancelled\nErrorCode.NetworkError\nErrorCode.ItemUnavailable\nErrorCode.AlreadyOwned\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-3-update-stream-listeners",children:"Step 3: Update Stream Listeners"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"_purchaseUpdatedSubscription = FlutterInappPurchase.iapUpdated.listen((data) {\n  print('purchase-updated: $data');\n});\n\n_purchaseErrorSubscription = FlutterInappPurchase.iapUpdated.listen((data) {\n  print('purchase-error: $data');\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"_purchaseUpdatedSubscription = FlutterInappPurchase.instance\n    .purchaseUpdated.listen((purchase) {\n  if (purchase != null) {\n    print('purchase-updated: ${purchase.productId}');\n    _handlePurchaseUpdate(purchase);\n  }\n});\n\n_purchaseErrorSubscription = FlutterInappPurchase.instance\n    .purchaseError.listen((error) {\n  print('purchase-error: ${error?.message}');\n  _handlePurchaseError(error);\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-4-update-product-fetching",children:"Step 4: Update Product Fetching"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> _getProducts() async {\n  List<IAPItem> items = await FlutterInappPurchase.instance\n      .fetchProducts(skus: _productIds, type: 'inapp');\n  setState(() {\n    _items = items;\n  });\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> _getProducts() async {\n  final result = await FlutterInappPurchase.instance.fetchProducts(\n    ProductRequest(\n      skus: _productIds,\n      type: ProductQueryType.InApp,\n    ),\n  );\n  setState(() {\n    _items = result.value;\n  });\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-5-update-purchase-requests",children:"Step 5: Update Purchase Requests"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"void _requestPurchase(IAPItem item) {\n  FlutterInappPurchase.instance.requestPurchase(item.productId);\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> _requestPurchase(ProductCommon item) async {\n  final requestProps = RequestPurchaseProps.inApp(\n    request: RequestPurchasePropsByPlatforms(\n      ios: RequestPurchaseIosProps(\n        sku: item.id,\n        quantity: 1,\n      ),\n      android: RequestPurchaseAndroidProps(\n        skus: [item.id],\n      ),\n    ),\n  );\n\n  await FlutterInappPurchase.instance.requestPurchase(requestProps);\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-6-update-transaction-completion",children:"Step 6: Update Transaction Completion"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// iOS\nawait FlutterInappPurchase.instance.finishTransaction(item);\n\n// Android\nawait FlutterInappPurchase.instance.consumePurchase(\n  purchaseToken: item.purchaseToken!,\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// iOS\nawait FlutterInappPurchase.instance.finishTransaction(\n  purchase: item,\n  isConsumable: true,\n);\n\n// Android\nawait FlutterInappPurchase.instance.consumePurchaseAndroid(\n  purchaseToken: item.purchaseToken!,\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-7-update-field-access",children:"Step 7: Update Field Access"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final id = product.productId;\nfinal price = product.localizedPrice;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final id = product.id;\nfinal price = product.displayPrice;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"complete-migration-example",children:"Complete Migration Example"}),"\n",(0,i.jsx)(n.h3,{id:"before-v5x",children:"Before (v5.x)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"class _MyStoreState extends State<MyStore> {\n  StreamSubscription? _purchaseSubscription;\n  List<IAPItem> _items = [];\n\n  @override\n  void initState() {\n    super.initState();\n    _init();\n  }\n\n  Future<void> _init() async {\n    await FlutterInappPurchase.instance.initConnection();\n\n    _purchaseSubscription = FlutterInappPurchase.iapUpdated.listen((data) {\n      print('purchase: $data');\n      _finishTransaction(data);\n    });\n\n    final items = await FlutterInappPurchase.instance\n        .fetchProducts(skus: _productIds, type: 'inapp');\n\n    setState(() {\n      _items = items;\n    });\n  }\n\n  void _buy(IAPItem item) {\n    FlutterInappPurchase.instance.requestPurchase(item.productId);\n  }\n\n  void _finishTransaction(Purchase item) {\n    FlutterInappPurchase.instance.finishTransaction(item);\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"after-v68",children:"After (v6.8+)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"class _MyStoreState extends State<MyStore> {\n  StreamSubscription? _purchaseSubscription;\n  List<ProductCommon> _items = [];\n\n  @override\n  void initState() {\n    super.initState();\n    _init();\n  }\n\n  Future<void> _init() async {\n    await FlutterInappPurchase.instance.initConnection();\n\n    _purchaseSubscription = FlutterInappPurchase.instance\n        .purchaseUpdated.listen((purchase) {\n      if (purchase != null) {\n        print('purchase: ${purchase.productId}');\n        _finishTransaction(purchase);\n      }\n    });\n\n    final result = await FlutterInappPurchase.instance.fetchProducts(\n      ProductRequest(\n        skus: _productIds,\n        type: ProductQueryType.InApp,\n      ),\n    );\n\n    setState(() {\n      _items = result.value;\n    });\n  }\n\n  Future<void> _buy(ProductCommon item) async {\n    final requestProps = RequestPurchaseProps.inApp(\n      request: RequestPurchasePropsByPlatforms(\n        ios: RequestPurchaseIosProps(\n          sku: item.id,\n          quantity: 1,\n        ),\n        android: RequestPurchaseAndroidProps(\n          skus: [item.id],\n        ),\n      ),\n    );\n\n    await FlutterInappPurchase.instance.requestPurchase(requestProps);\n  }\n\n  Future<void> _finishTransaction(Purchase item) async {\n    await FlutterInappPurchase.instance.finishTransaction(\n      purchase: item,\n      isConsumable: true,\n    );\n  }\n\n  @override\n  void dispose() {\n    _purchaseSubscription?.cancel();\n    super.dispose();\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"testing-checklist",children:"Testing Checklist"}),"\n",(0,i.jsx)(n.p,{children:"After migration, test the following:"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","App compiles without errors"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","IAP connection initializes successfully"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Products load correctly"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Purchase flow completes"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Transactions finish properly"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Error handling works (test by cancelling a purchase)"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Restore purchases works"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Both iOS and Android platforms tested"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"common-migration-issues",children:"Common Migration Issues"}),"\n",(0,i.jsx)(n.h3,{id:"issue-1-errorcodee_user_cancelled-not-found",children:'Issue 1: "ErrorCode.E_USER_CANCELLED not found"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Update to new PascalCase format:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"ErrorCode.UserCancelled\n"})}),"\n",(0,i.jsx)(n.h3,{id:"issue-2-productid-doesnt-exist",children:'Issue 2: "productId doesn\'t exist"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Change to ",(0,i.jsx)(n.code,{children:"id"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Before\nitem.productId\n\n// After\nitem.id\n"})}),"\n",(0,i.jsx)(n.h3,{id:"issue-3-localizedprice-doesnt-exist",children:'Issue 3: "localizedPrice doesn\'t exist"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Change to ",(0,i.jsx)(n.code,{children:"displayPrice"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Before\nitem.localizedPrice\n\n// After\nitem.displayPrice\n"})}),"\n",(0,i.jsx)(n.h3,{id:"issue-4-type-argument-required",children:'Issue 4: "type argument required"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Add ProductQueryType:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"ProductRequest(\n  skus: ['product_id'],\n  type: ProductQueryType.InApp, // Required\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"benefits-of-v68",children:"Benefits of v6.8+"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OpenIAP Standard"}),": Full compliance with OpenIAP specification"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Better Type Safety"}),": Strongly typed APIs with fewer runtime errors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Improved Error Handling"}),": Clearer error codes and messages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Modern Platform Support"}),": Latest iOS StoreKit 2 and Android Billing v8"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Better Documentation"}),": Comprehensive guides aligned with OpenIAP"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cross-Platform Consistency"}),": Unified API across iOS and Android"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"need-help",children:"Need Help?"}),"\n",(0,i.jsx)(n.p,{children:"If you encounter issues during migration:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Check the ",(0,i.jsx)(n.a,{href:"../troubleshooting",children:"Troubleshooting Guide"})]}),"\n",(0,i.jsxs)(n.li,{children:["Review the ",(0,i.jsx)(n.a,{href:"../api/overview",children:"API Documentation"})]}),"\n",(0,i.jsxs)(n.li,{children:["Look at the ",(0,i.jsx)(n.a,{href:"../examples/basic-store",children:"Examples"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/hyochan/flutter_inapp_purchase/issues",children:"Open an issue"})," on GitHub"]}),"\n",(0,i.jsxs)(n.li,{children:["Join our ",(0,i.jsx)(n.a,{href:"https://discord.gg/hyo",children:"Discord Community"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.openiap.dev",children:"OpenIAP Specification"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../getting-started/quickstart",children:"Quick Start Guide"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../guides/error-handling",children:"Error Handling Guide"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../guides/products",children:"Products Guide"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../guides/purchases",children:"Purchases Guide"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>d});var s=r(6540);const i={},t=s.createContext(i);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);