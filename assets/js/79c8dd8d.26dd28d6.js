"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[6078],{27856:(e,a,n)=>{n.d(a,{I:()=>r,V:()=>s});const s="https://iapkit.com",r="https://www.hyo.dev/api/ad-banner/cmjf0l1x30001249hbi91aop6"},28453:(e,a,n)=>{n.d(a,{R:()=>c,x:()=>i});var s=n(96540);const r={},t=s.createContext(r);function c(e){const a=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:a},e.children)}},35159:(e,a,n)=>{n.d(a,{A:()=>t});n(96540);var s=n(27856),r=n(74848);function t({style:e}){return(0,r.jsx)("div",{style:{marginTop:24,marginBottom:24,textAlign:"center",...e},children:(0,r.jsx)("a",{href:s.V,target:"_blank",rel:"noopener noreferrer",onClick:async()=>{try{await fetch(s.I,{method:"POST",mode:"no-cors"})}catch(e){}},children:(0,r.jsx)("img",{src:n(65860).A,alt:"IapKit - Fraud-proof your in-app purchases",style:{objectFit:"cover",border:"none"}})})})}},48432:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>h,contentTitle:()=>d,default:()=>o,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"api/types/purchase-state","title":"Purchase States","description":"Types and enums representing the state of purchases and transactions.","source":"@site/versioned_docs/version-8.1/api/types/purchase-state.md","sourceDirName":"api/types","slug":"/api/types/purchase-state","permalink":"/flutter_inapp_purchase/8.1/api/types/purchase-state","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/versioned_docs/version-8.1/api/types/purchase-state.md","tags":[],"version":"8.1","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Purchase States"}}');var r=n(74848),t=n(28453),c=n(35159);const i={sidebar_position:2,title:"Purchase States"},d="Purchase States",h={},l=[{value:"PurchaseState",id:"purchasestate",level:2},{value:"Usage",id:"usage",level:3},{value:"Purchase Classes",id:"purchase-classes",level:2},{value:"PurchaseIOS",id:"purchaseios",level:3},{value:"PurchaseAndroid",id:"purchaseandroid",level:3},{value:"Handling Purchase States",id:"handling-purchase-states",level:2},{value:"Basic Purchase Handling",id:"basic-purchase-handling",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related",id:"related",level:2}];function u(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.header,{children:(0,r.jsx)(a.h1,{id:"purchase-states",children:"Purchase States"})}),"\n",(0,r.jsx)(c.A,{}),"\n",(0,r.jsx)(a.p,{children:"Types and enums representing the state of purchases and transactions."}),"\n",(0,r.jsx)(a.h2,{id:"purchasestate",children:"PurchaseState"}),"\n",(0,r.jsx)(a.p,{children:"Enum representing the state of a purchase."}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-dart",children:"enum PurchaseState {\n  Pending,      // Purchase is pending (awaiting payment)\n  Purchased,    // Purchase completed successfully\n  Failed,       // Purchase failed\n  Restored,     // Purchase was restored\n  Deferred,     // Purchase deferred (e.g., Ask to Buy on iOS)\n  Unknown,      // Unknown/unspecified state\n}\n"})}),"\n",(0,r.jsx)(a.h3,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-dart",children:"void _handlePurchase(Purchase purchase) {\n  // PurchaseState is available in both PurchaseIOS and PurchaseAndroid\n  final state = purchase is PurchaseIOS\n    ? purchase.transactionState\n    : (purchase as PurchaseAndroid).purchaseState;\n\n  switch (state) {\n    case PurchaseState.Purchased:\n      // Purchase completed - safe to deliver content\n      _deliverContent(purchase.productId);\n      break;\n\n    case PurchaseState.Pending:\n      // Payment pending - wait for completion\n      _showPendingMessage();\n      break;\n\n    case PurchaseState.Failed:\n      // Purchase failed\n      _showErrorMessage();\n      break;\n\n    case PurchaseState.Restored:\n      // Purchase was restored\n      _deliverContent(purchase.productId);\n      break;\n\n    case PurchaseState.Deferred:\n      // Waiting for parental approval (iOS Ask to Buy)\n      _showDeferredMessage();\n      break;\n\n    case PurchaseState.Unknown:\n      // Unknown state - handle cautiously\n      debugPrint('Unknown purchase state');\n      break;\n  }\n}\n"})}),"\n",(0,r.jsx)(a.h2,{id:"purchase-classes",children:"Purchase Classes"}),"\n",(0,r.jsx)(a.p,{children:"flutter_inapp_purchase uses union types for purchases. When you receive purchases, you get platform-specific purchase types."}),"\n",(0,r.jsx)(a.h3,{id:"purchaseios",children:"PurchaseIOS"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-dart",children:"class PurchaseIOS extends Purchase {\n  final String id;\n  final String originalId;\n  final String productId;\n  final DateTime purchaseDate;\n  final PurchaseState transactionState;\n  final String? receiptData;\n  // ... additional iOS-specific properties\n}\n"})}),"\n",(0,r.jsx)(a.h3,{id:"purchaseandroid",children:"PurchaseAndroid"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-dart",children:"class PurchaseAndroid extends Purchase {\n  final String? orderId;\n  final String productId;\n  final PurchaseState purchaseState;\n  final int purchaseTime;\n  final String purchaseToken;\n  final bool acknowledged;\n  // ... additional Android-specific properties\n}\n"})}),"\n",(0,r.jsx)(a.h2,{id:"handling-purchase-states",children:"Handling Purchase States"}),"\n",(0,r.jsx)(a.h3,{id:"basic-purchase-handling",children:"Basic Purchase Handling"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-dart",children:"void _handlePurchase(Purchase purchase) async {\n  if (purchase is PurchaseIOS) {\n    switch (purchase.transactionState) {\n      case PurchaseState.Purchased:\n      case PurchaseState.Restored:\n        await _deliverContent(purchase.productId);\n        await iap.finishTransaction(\n          purchase: purchase,\n          isConsumable: false,\n        );\n        break;\n\n      case PurchaseState.Deferred:\n        _showMessage('Waiting for approval...');\n        break;\n\n      case PurchaseState.Failed:\n        _showMessage('Purchase failed');\n        break;\n\n      default:\n        break;\n    }\n  } else if (purchase is PurchaseAndroid) {\n    switch (purchase.purchaseState) {\n      case PurchaseState.Purchased:\n        if (!purchase.acknowledged) {\n          await _deliverContent(purchase.productId);\n          await iap.finishTransaction(\n            purchase: purchase,\n            isConsumable: false,\n          );\n        }\n        break;\n\n      case PurchaseState.Pending:\n        _showMessage('Purchase pending...');\n        break;\n\n      default:\n        break;\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(a.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Handle all states"})," - Don't assume purchases will always be in ",(0,r.jsx)(a.code,{children:"Purchased"})," state"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Check acknowledgment"})," - On Android, check if purchase needs acknowledgment"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Finish transactions"})," - Always finish transactions after delivering content"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Handle pending"})," - Support pending purchases for async payment methods"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Persist state"})," - Save purchase state locally for recovery"]}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"related",children:"Related"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.a,{href:"./error-codes",children:"Error Codes"})," - Error states and codes"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.a,{href:"./product-type",children:"Product Types"})," - Product-related types"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.a,{href:"../../guides/lifecycle",children:"Purchase Lifecycle"})," - Complete purchase flow"]}),"\n"]})]})}function o(e={}){const{wrapper:a}={...(0,t.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},65860:(e,a,n)=>{n.d(a,{A:()=>s});const s=n.p+"assets/images/iapkit-banner-c71d8c3f875ca90b812e7b54822795d2.gif"}}]);