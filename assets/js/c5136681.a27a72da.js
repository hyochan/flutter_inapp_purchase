"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[7174],{17529:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>t,metadata:()=>l,toc:()=>s});var l=i(18234),r=i(74848),a=i(28453);const t={slug:"8.1.2-release",title:"8.1.2 - External Payments Program",authors:["hyochan"],tags:["release","android","billing","external-payments"]},o=void 0,d={authorsImageUrls:[void 0]},s=[{value:"What&#39;s New",id:"whats-new",level:2},{value:"External Payments Program (Android 8.3.0+, Japan Only)",id:"external-payments-program-android-830-japan-only",level:3},{value:"New APIs",id:"new-apis",level:3},{value:"BillingProgramAndroid.ExternalPayments",id:"billingprogramandroidexternalpayments",level:4},{value:"DeveloperBillingOptionParamsAndroid",id:"developerbillingoptionparamsandroid",level:4},{value:"DeveloperBillingLaunchModeAndroid",id:"developerbillinglaunchmodeandroid",level:4},{value:"developerProvidedBillingAndroid Stream",id:"developerprovidedbillingandroid-stream",level:4},{value:"New Event",id:"new-event",level:3},{value:"Implementation Example",id:"implementation-example",level:2},{value:"enableBillingProgramAndroid in InitConnectionConfig (Android)",id:"enablebillingprogramandroid-in-initconnectionconfig-android",level:3},{value:"Important Notes",id:"important-notes",level:2},{value:"Dependencies",id:"dependencies",level:2}];function p(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"v8.1.2 adds support for Google Play Billing Library 8.3.0's External Payments program and enableBillingProgramAndroid in InitConnectionConfig."}),"\n",(0,r.jsx)(n.h2,{id:"whats-new",children:"What's New"}),"\n",(0,r.jsx)(n.h3,{id:"external-payments-program-android-830-japan-only",children:"External Payments Program (Android 8.3.0+, Japan Only)"}),"\n",(0,r.jsx)(n.p,{children:"Google Play Billing Library 8.3.0 introduces the External Payments program, which presents users with a side-by-side choice between Google Play Billing and the developer's external payment option directly in the purchase flow."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key differences from User Choice Billing:"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Feature"}),(0,r.jsx)(n.th,{children:"User Choice Billing"}),(0,r.jsx)(n.th,{children:"External Payments"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Billing Library"}),(0,r.jsx)(n.td,{children:"7.0+"}),(0,r.jsx)(n.td,{children:"8.3.0+"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Availability"}),(0,r.jsx)(n.td,{children:"Eligible regions"}),(0,r.jsx)(n.td,{children:"Japan only"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"UI"}),(0,r.jsx)(n.td,{children:"Separate dialog"}),(0,r.jsx)(n.td,{children:"Side-by-side in purchase dialog"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"new-apis",children:"New APIs"}),"\n",(0,r.jsx)(n.h4,{id:"billingprogramandroidexternalpayments",children:"BillingProgramAndroid.ExternalPayments"}),"\n",(0,r.jsx)(n.p,{children:"New billing program type for external payments:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"final isAvailable = await iap.isBillingProgramAvailableAndroid(\n  BillingProgramAndroid.ExternalPayments,\n);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"developerbillingoptionparamsandroid",children:"DeveloperBillingOptionParamsAndroid"}),"\n",(0,r.jsx)(n.p,{children:"Configure the external payment option in the purchase flow:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"await iap.requestPurchaseWithBuilder(\n  build: (builder) {\n    builder.android.skus = ['product_id'];\n    builder.android.developerBillingOption = DeveloperBillingOptionParamsAndroid(\n      billingProgram: BillingProgramAndroid.ExternalPayments,\n      launchMode: DeveloperBillingLaunchModeAndroid.LaunchInExternalBrowserOrApp,\n      linkUri: 'https://example.com/checkout',\n    );\n    builder.type = ProductQueryType.InApp;\n  },\n);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"developerbillinglaunchmodeandroid",children:"DeveloperBillingLaunchModeAndroid"}),"\n",(0,r.jsx)(n.p,{children:"Controls how the external payment link is launched:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"LaunchInExternalBrowserOrApp"}),": Google Play launches the URL in external browser"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CallerWillLaunchLink"}),": Your app handles launching the URL"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"developerprovidedbillingandroid-stream",children:"developerProvidedBillingAndroid Stream"}),"\n",(0,r.jsx)(n.p,{children:"Listen for when a user selects the developer billing option:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"iap.developerProvidedBillingAndroid.listen((details) {\n  // User selected developer billing\n  final token = details.externalTransactionToken;\n\n  // IMPORTANT: Report transaction to Google within 24 hours\n  await reportExternalTransaction(token);\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"new-event",children:"New Event"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"IapEvent.DeveloperProvidedBillingAndroid"})," - Fired when user selects developer billing in the External Payments flow."]}),"\n",(0,r.jsx)(n.h2,{id:"implementation-example",children:"Implementation Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:flutter_inapp_purchase/flutter_inapp_purchase.dart';\n\nclass ExternalPaymentsExample {\n  final iap = FlutterInappPurchase.instance;\n  StreamSubscription? _developerBillingSubscription;\n\n  Future<void> setup() async {\n    await iap.initConnection();\n\n    // Listen for developer billing selection\n    _developerBillingSubscription =\n        iap.developerProvidedBillingAndroid.listen((details) async {\n      // User chose developer billing\n      // The externalTransactionToken MUST be reported to Google within 24 hours\n      await reportToBackend(details.externalTransactionToken);\n    });\n  }\n\n  Future<void> purchaseWithExternalOption(String productId) async {\n    // Check if External Payments is available\n    final availability = await iap.isBillingProgramAvailableAndroid(\n      BillingProgramAndroid.ExternalPayments,\n    );\n\n    if (!availability.isAvailable) {\n      // Fall back to standard purchase\n      await standardPurchase(productId);\n      return;\n    }\n\n    // Request purchase with external payment option\n    await iap.requestPurchaseWithBuilder(\n      build: (builder) {\n        builder.android.skus = [productId];\n        builder.android.developerBillingOption = DeveloperBillingOptionParamsAndroid(\n          billingProgram: BillingProgramAndroid.ExternalPayments,\n          launchMode: DeveloperBillingLaunchModeAndroid.LaunchInExternalBrowserOrApp,\n          linkUri: 'https://yoursite.com/checkout?product=$productId',\n        );\n        builder.type = ProductQueryType.InApp;\n      },\n    );\n  }\n\n  void dispose() {\n    _developerBillingSubscription?.cancel();\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"enablebillingprogramandroid-in-initconnectionconfig-android",children:"enableBillingProgramAndroid in InitConnectionConfig (Android)"}),"\n",(0,r.jsxs)(n.p,{children:["New ",(0,r.jsx)(n.code,{children:"enableBillingProgramAndroid"})," field in ",(0,r.jsx)(n.code,{children:"InitConnectionConfig"})," for easier billing program setup during connection initialization:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"// Enable External Payments during connection\nawait iap.initConnection(\n  enableBillingProgramAndroid: BillingProgramAndroid.ExternalPayments,\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This provides a cleaner alternative to calling ",(0,r.jsx)(n.code,{children:"enableBillingProgram()"})," separately before ",(0,r.jsx)(n.code,{children:"initConnection()"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Japan Only"}),": External Payments is currently only available in Japan"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Token Reporting"}),": You MUST report the ",(0,r.jsx)(n.code,{children:"externalTransactionToken"})," to Google Play within 24 hours"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"8.3.0+ Required"}),": This feature requires Google Play Billing Library 8.3.0 or higher"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"Updated OpenIAP versions:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openiap-gql"}),": 1.3.8 -> 1.3.10"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openiap-google"}),": 1.3.16 -> 1.3.19"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openiap-apple"}),": 1.3.7 -> 1.3.8"]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},18234:e=>{e.exports=JSON.parse('{"permalink":"/flutter_inapp_purchase/blog/8.1.2-release","editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/blog/2025-12-28-8.1.2.release.md","source":"@site/blog/2025-12-28-8.1.2.release.md","title":"8.1.2 - External Payments Program","description":"v8.1.2 adds support for Google Play Billing Library 8.3.0\'s External Payments program and enableBillingProgramAndroid in InitConnectionConfig.","date":"2025-12-28T00:00:00.000Z","tags":[{"inline":false,"label":"Release","permalink":"/flutter_inapp_purchase/blog/tags/release","description":"New version releases and updates"},{"inline":false,"label":"Android","permalink":"/flutter_inapp_purchase/blog/tags/android","description":"Android platform updates"},{"inline":false,"label":"Billing","permalink":"/flutter_inapp_purchase/blog/tags/billing","description":"Google Play Billing Library updates"},{"inline":false,"label":"External Payments","permalink":"/flutter_inapp_purchase/blog/tags/external-payments","description":"External payments program support"}],"readingTime":2.03,"hasTruncateMarker":true,"authors":[{"name":"Hyo","title":"Maintainer of flutter_inapp_purchase & expo-iap","url":"https://github.com/hyochan","page":{"permalink":"/flutter_inapp_purchase/blog/authors/hyochan"},"socials":{"x":"https://x.com/hyodotdev","github":"https://github.com/hyochan"},"imageURL":"https://github.com/hyochan.png","key":"hyochan"}],"frontMatter":{"slug":"8.1.2-release","title":"8.1.2 - External Payments Program","authors":["hyochan"],"tags":["release","android","billing","external-payments"]},"unlisted":false,"prevItem":{"title":"8.2.0 - PurchaseState Cleanup and API Consolidation","permalink":"/flutter_inapp_purchase/blog/8.2.0-release"},"nextItem":{"title":"8.1.0 - Advanced Commerce Data & Promoted Products","permalink":"/flutter_inapp_purchase/blog/8.1.0-release"}}')},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var l=i(96540);const r={},a=l.createContext(r);function t(e){const n=l.useContext(a);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(a.Provider,{value:n},e.children)}}}]);