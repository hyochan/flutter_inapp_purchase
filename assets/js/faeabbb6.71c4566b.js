"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[7850],{28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var s=t(96540);const r={},a=s.createContext(r);function i(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:n},e.children)}},29957:e=>{e.exports=JSON.parse('{"permalink":"/flutter_inapp_purchase/blog/8.2.5","editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/blog/2026-01-26-8.2.5-external-purchase-custom-link.md","source":"@site/blog/2026-01-26-8.2.5-external-purchase-custom-link.md","title":"8.2.5 - ExternalPurchaseCustomLink API (iOS 18.1+)","description":"flutterinapppurchase 8.2.5 adds support for Apple\'s ExternalPurchaseCustomLink API (iOS 18.1+) for apps using custom external purchase links.","date":"2026-01-26T00:00:00.000Z","tags":[{"inline":false,"label":"Release","permalink":"/flutter_inapp_purchase/blog/tags/release","description":"New version releases and updates"},{"inline":false,"label":"iOS","permalink":"/flutter_inapp_purchase/blog/tags/ios","description":"Apple iOS platform updates"},{"inline":true,"label":"storekit","permalink":"/flutter_inapp_purchase/blog/tags/storekit"},{"inline":true,"label":"external-purchase","permalink":"/flutter_inapp_purchase/blog/tags/external-purchase"},{"inline":true,"label":"ios-18","permalink":"/flutter_inapp_purchase/blog/tags/ios-18"}],"readingTime":2.17,"hasTruncateMarker":true,"authors":[{"name":"Hyo","title":"Maintainer of flutter_inapp_purchase & expo-iap","url":"https://github.com/hyochan","page":{"permalink":"/flutter_inapp_purchase/blog/authors/hyochan"},"socials":{"x":"https://x.com/hyodotdev","github":"https://github.com/hyochan"},"imageURL":"https://github.com/hyochan.png","key":"hyochan"}],"frontMatter":{"slug":"8.2.5","title":"8.2.5 - ExternalPurchaseCustomLink API (iOS 18.1+)","authors":["hyochan"],"tags":["release","ios","storekit","external-purchase","ios-18"],"date":"2026-01-26T00:00:00.000Z"},"unlisted":false,"nextItem":{"title":"8.2.3 - One-Time Purchase Discounts and Simplified Field Names","permalink":"/flutter_inapp_purchase/blog/8.2.3-release"}}')},46154:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var s=t(29957),r=t(74848),a=t(28453);const i={slug:"8.2.5",title:"8.2.5 - ExternalPurchaseCustomLink API (iOS 18.1+)",authors:["hyochan"],tags:["release","ios","storekit","external-purchase","ios-18"],date:new Date("2026-01-26T00:00:00.000Z")},l="8.2.5 Release Notes",o={authorsImageUrls:[void 0]},c=[{value:"New Features",id:"new-features",level:2},{value:"ExternalPurchaseCustomLink API (iOS 18.1+)",id:"externalpurchasecustomlink-api-ios-181",level:3},{value:"New APIs",id:"new-apis",level:3},{value:"<code>isEligibleForExternalPurchaseCustomLinkIOS()</code>",id:"iseligibleforexternalpurchasecustomlinkios",level:4},{value:"<code>getExternalPurchaseCustomLinkTokenIOS(tokenType)</code>",id:"getexternalpurchasecustomlinktokeniostokentype",level:4},{value:"<code>showExternalPurchaseCustomLinkNoticeIOS(noticeType)</code>",id:"showexternalpurchasecustomlinknoticeiosnoticetype",level:4},{value:"Updated: <code>presentExternalPurchaseNoticeSheetIOS()</code>",id:"updated-presentexternalpurchasenoticesheetios",level:3},{value:"New Types",id:"new-types",level:3},{value:"Complete External Purchase Custom Link Flow",id:"complete-external-purchase-custom-link-flow",level:3},{value:"OpenIAP Updates",id:"openiap-updates",level:2},{value:"Installation",id:"installation",level:2},{value:"References",id:"references",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["flutter_inapp_purchase 8.2.5 adds support for Apple's ",(0,r.jsx)(n.strong,{children:"ExternalPurchaseCustomLink"})," API (iOS 18.1+) for apps using custom external purchase links."]}),"\n",(0,r.jsx)(n.h2,{id:"new-features",children:"New Features"}),"\n",(0,r.jsx)(n.h3,{id:"externalpurchasecustomlink-api-ios-181",children:"ExternalPurchaseCustomLink API (iOS 18.1+)"}),"\n",(0,r.jsx)(n.p,{children:"The ExternalPurchaseCustomLink API enables apps to use custom external purchase links with token-based reporting to Apple. This is for apps that have been granted an entitlement to link out to external purchases."}),"\n",(0,r.jsxs)(n.p,{children:["Reference: ",(0,r.jsx)(n.a,{href:"https://developer.apple.com/documentation/storekit/externalpurchasecustomlink",children:"ExternalPurchaseCustomLink Documentation"})]}),"\n",(0,r.jsx)(n.h3,{id:"new-apis",children:"New APIs"}),"\n",(0,r.jsx)(n.h4,{id:"iseligibleforexternalpurchasecustomlinkios",children:(0,r.jsx)(n.code,{children:"isEligibleForExternalPurchaseCustomLinkIOS()"})}),"\n",(0,r.jsx)(n.p,{children:"Check if your app is eligible to use the ExternalPurchaseCustomLink API."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'package:flutter_inapp_purchase/flutter_inapp_purchase.dart';\n\nfinal iap = FlutterInappPurchase.instance;\nfinal isEligible = await iap.isEligibleForExternalPurchaseCustomLinkIOS();\nif (isEligible) {\n  // App can use custom external purchase links\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"getexternalpurchasecustomlinktokeniostokentype",children:(0,r.jsx)(n.code,{children:"getExternalPurchaseCustomLinkTokenIOS(tokenType)"})}),"\n",(0,r.jsx)(n.p,{children:"Get an external purchase token for reporting to Apple's External Purchase Server API."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"// For new customer acquisition\nfinal acquisitionResult = await iap.getExternalPurchaseCustomLinkTokenIOS(\n  ExternalPurchaseCustomLinkTokenTypeIOS.Acquisition,\n);\nif (acquisitionResult.token != null) {\n  // Report to Apple's External Purchase Server API\n  await reportToApple(acquisitionResult.token!);\n}\n\n// For existing customer services\nfinal servicesResult = await iap.getExternalPurchaseCustomLinkTokenIOS(\n  ExternalPurchaseCustomLinkTokenTypeIOS.Services,\n);\nif (servicesResult.token != null) {\n  await reportToApple(servicesResult.token!);\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"showexternalpurchasecustomlinknoticeiosnoticetype",children:(0,r.jsx)(n.code,{children:"showExternalPurchaseCustomLinkNoticeIOS(noticeType)"})}),"\n",(0,r.jsx)(n.p,{children:"Display the system disclosure notice sheet before linking out to external purchases."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"final result = await iap.showExternalPurchaseCustomLinkNoticeIOS(\n  ExternalPurchaseCustomLinkNoticeTypeIOS.Browser,\n);\nif (result.continued) {\n  // User agreed to continue to external purchase\n  // Now open your external purchase link\n  await launchUrl(Uri.parse('https://your-store.com/checkout'));\n} else {\n  // User cancelled\n}\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"updated-presentexternalpurchasenoticesheetios",children:["Updated: ",(0,r.jsx)(n.code,{children:"presentExternalPurchaseNoticeSheetIOS()"})]}),"\n",(0,r.jsxs)(n.p,{children:["Now returns ",(0,r.jsx)(n.code,{children:"externalPurchaseToken"})," when user continues to external purchase."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"final result = await iap.presentExternalPurchaseNoticeSheetIOS();\nif (result.result == ExternalPurchaseNoticeAction.Continue) {\n  print('Token: ${result.externalPurchaseToken}');\n  // Report this token to Apple's External Purchase Server API\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"new-types",children:"New Types"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"// Token types for getExternalPurchaseCustomLinkTokenIOS\nenum ExternalPurchaseCustomLinkTokenTypeIOS {\n  Acquisition('acquisition'),\n  Services('services');\n}\n\n// Notice types for showExternalPurchaseCustomLinkNoticeIOS\nenum ExternalPurchaseCustomLinkNoticeTypeIOS {\n  Browser('browser');\n}\n\n// Result of token retrieval\nclass ExternalPurchaseCustomLinkTokenResultIOS {\n  final String? token;\n  final String? error;\n}\n\n// Result of showing notice\nclass ExternalPurchaseCustomLinkNoticeResultIOS {\n  final bool continued;\n  final String? error;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"complete-external-purchase-custom-link-flow",children:"Complete External Purchase Custom Link Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"import 'dart:io';\nimport 'package:flutter_inapp_purchase/flutter_inapp_purchase.dart';\nimport 'package:url_launcher/url_launcher.dart';\n\nclass ExternalPurchaseCustomLinkExample {\n  final iap = FlutterInappPurchase.instance;\n  bool isEligible = false;\n\n  Future<void> checkEligibility() async {\n    if (!Platform.isIOS) return;\n    isEligible = await iap.isEligibleForExternalPurchaseCustomLinkIOS();\n  }\n\n  Future<void> handleExternalPurchase() async {\n    if (!isEligible) return;\n\n    // Step 1: Show disclosure notice\n    final noticeResult = await iap.showExternalPurchaseCustomLinkNoticeIOS(\n      ExternalPurchaseCustomLinkNoticeTypeIOS.Browser,\n    );\n    if (!noticeResult.continued) {\n      print('User cancelled');\n      return;\n    }\n\n    // Step 2: Get token for reporting\n    final tokenResult = await iap.getExternalPurchaseCustomLinkTokenIOS(\n      ExternalPurchaseCustomLinkTokenTypeIOS.Acquisition,\n    );\n    if (tokenResult.error != null) {\n      print('Failed to get token: ${tokenResult.error}');\n      return;\n    }\n\n    // Step 3: Open external purchase link\n    await launchUrl(Uri.parse('https://your-store.com/checkout'));\n\n    // Step 4: After purchase completes, report to Apple\n    if (tokenResult.token != null) {\n      await reportExternalPurchaseToApple(tokenResult.token!);\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"openiap-updates",children:"OpenIAP Updates"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Package"}),(0,r.jsx)(n.th,{children:"Version"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"openiap-gql"}),(0,r.jsx)(n.td,{children:"1.3.16"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"openiap-apple"}),(0,r.jsx)(n.td,{children:"1.3.14"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"openiap-google"}),(0,r.jsx)(n.td,{children:"1.3.27"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"dependencies:\n  flutter_inapp_purchase: ^8.2.5\n"})}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developer.apple.com/documentation/storekit/externalpurchasecustomlink",children:"Apple ExternalPurchaseCustomLink Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.openiap.dev/docs/updates/notes#gql-1-3-16-apple-1-3-14",children:"OpenIAP Release Notes"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Questions or feedback? Reach out via ",(0,r.jsx)(n.a,{href:"https://github.com/hyochan/flutter_inapp_purchase/issues",children:"GitHub issues"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);