"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[5359],{8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var i=r(6540);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}},8829:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"guides/subscription-offers","title":"Subscription Offers","description":"Handle subscription purchases, upgrades, downgrades, and promotional offers.","source":"@site/docs/guides/subscription-offers.md","sourceDirName":"guides","slug":"/guides/subscription-offers","permalink":"/flutter_inapp_purchase/docs/guides/subscription-offers","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/docs/guides/subscription-offers.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Subscription Offers"},"sidebar":"docsSidebar","previous":{"title":"Purchase Lifecycle","permalink":"/flutter_inapp_purchase/docs/guides/lifecycle"},"next":{"title":"Subscription Validation","permalink":"/flutter_inapp_purchase/docs/guides/subscription-validation"}}');var s=r(4848),t=r(8453);const a={sidebar_position:3,title:"Subscription Offers"},o="Subscription Offers",c={},d=[{value:"Fetch Subscription Products",id:"fetch-subscription-products",level:2},{value:"Basic Subscription Purchase",id:"basic-subscription-purchase",level:2},{value:"Android with Offers",id:"android-with-offers",level:3},{value:"iOS Subscription",id:"ios-subscription",level:3},{value:"Upgrade/Downgrade Subscriptions (Android)",id:"upgradedowngrade-subscriptions-android",level:2},{value:"Replacement Modes (Android)",id:"replacement-modes-android",level:2},{value:"Check Active Subscriptions",id:"check-active-subscriptions",level:2},{value:"Quick Check (Lightweight)",id:"quick-check-lightweight",level:3},{value:"Detailed Purchase Information",id:"detailed-purchase-information",level:3},{value:"Get Purchase History (iOS)",id:"get-purchase-history-ios",level:3},{value:"Handle Subscription Purchase",id:"handle-subscription-purchase",level:2},{value:"iOS Promotional Offers",id:"ios-promotional-offers",level:2},{value:"Check Eligibility",id:"check-eligibility",level:3},{value:"Apply Promotional Offer",id:"apply-promotional-offer",level:3},{value:"Handle Promotional Offer Upgrades",id:"handle-promotional-offer-upgrades",level:3},{value:"Example: Upgrade Monthly to Yearly with Promo Offer",id:"example-upgrade-monthly-to-yearly-with-promo-offer",level:4},{value:"Alternative: Reload Subscriptions After Purchase",id:"alternative-reload-subscriptions-after-purchase",level:4},{value:"Why This Happens",id:"why-this-happens",level:4},{value:"RenewalInfo Fields",id:"renewalinfo-fields",level:4},{value:"Sandbox Testing Notes",id:"sandbox-testing-notes",level:4},{value:"Manage Subscriptions",id:"manage-subscriptions",level:2},{value:"Restore Purchases",id:"restore-purchases",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"subscription-offers",children:"Subscription Offers"})}),"\n",(0,s.jsx)(n.p,{children:"Handle subscription purchases, upgrades, downgrades, and promotional offers."}),"\n",(0,s.jsx)(n.h2,{id:"fetch-subscription-products",children:"Fetch Subscription Products"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final subscriptions = await iap.fetchProducts(\n  skus: ['monthly_sub', 'yearly_sub'],\n  type: ProductQueryType.subs,\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"basic-subscription-purchase",children:"Basic Subscription Purchase"}),"\n",(0,s.jsx)(n.h3,{id:"android-with-offers",children:"Android with Offers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"// Get available offers for Android\nList<AndroidSubscriptionOfferInput> getAndroidOffers(ProductCommon product) {\n  if (product is ProductAndroid) {\n    final details = product.subscriptionOfferDetailsAndroid;\n    if (details != null && details.isNotEmpty) {\n      return [\n        for (final offer in details)\n          AndroidSubscriptionOfferInput(\n            offerToken: offer.offerToken,\n            sku: product.id, // Use productId, not basePlanId\n          ),\n      ];\n    }\n  }\n  return [];\n}\n\n// Purchase subscription with offers\nFuture<void> purchaseSubscription(ProductCommon product) async {\n  if (Platform.isAndroid) {\n    final offers = getAndroidOffers(product);\n    final requestProps = RequestPurchaseProps.subs((\n      ios: null,\n      android: RequestSubscriptionAndroidProps(\n        skus: [product.id],\n        subscriptionOffers: offers.isNotEmpty ? offers : null,\n      ),\n      useAlternativeBilling: null,\n    ));\n\n    await iap.requestPurchase(requestProps);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ios-subscription",children:"iOS Subscription"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"Future<void> purchaseSubscriptionIOS(ProductCommon product) async {\n  final requestProps = RequestPurchaseProps.subs((\n    ios: RequestSubscriptionIosProps(\n      sku: product.id,\n    ),\n    android: null,\n    useAlternativeBilling: null,\n  ));\n\n  await iap.requestPurchase(requestProps);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"upgradedowngrade-subscriptions-android",children:"Upgrade/Downgrade Subscriptions (Android)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"Future<void> upgradeSubscription(\n  ProductCommon newProduct,\n  Purchase currentSubscription,\n  int replacementMode,\n) async {\n  final requestProps = RequestPurchaseProps.subs((\n    ios: null,\n    android: RequestSubscriptionAndroidProps(\n      skus: [newProduct.id],\n      oldSkus: [currentSubscription.productId],\n      purchaseTokenAndroid: currentSubscription.purchaseToken,\n      replacementModeAndroid: replacementMode,\n    ),\n    useAlternativeBilling: null,\n  ));\n\n  await iap.requestPurchase(requestProps);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"replacement-modes-android",children:"Replacement Modes (Android)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"// Use AndroidReplacementMode enum\nAndroidReplacementMode.withTimeProration.value         // 1: Credit unused time\nAndroidReplacementMode.chargeProratedPrice.value       // 2: Charge difference now\nAndroidReplacementMode.withoutProration.value          // 3: No credit\nAndroidReplacementMode.deferred.value                  // 4: Apply at next renewal\nAndroidReplacementMode.chargeFullPrice.value           // 5: Charge full price now\n"})}),"\n",(0,s.jsx)(n.h2,{id:"check-active-subscriptions",children:"Check Active Subscriptions"}),"\n",(0,s.jsx)(n.h3,{id:"quick-check-lightweight",children:"Quick Check (Lightweight)"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"getActiveSubscriptions"})," for lightweight subscription status:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"// Get active subscription summaries (lightweight)\nfinal summaries = await iap.getActiveSubscriptions([\n  'monthly_sub',\n  'yearly_sub',\n]);\n\nfor (final summary in summaries) {\n  print('Product: ${summary.productId}');\n  print('Transaction ID: ${summary.transactionId}');\n  print('Auto-renewing: ${summary.autoRenewingAndroid}');\n  print('Expiration: ${summary.expirationDateIOS}');\n}\n\nfinal hasActiveSubscription = summaries.isNotEmpty;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"detailed-purchase-information",children:"Detailed Purchase Information"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"getAvailablePurchases"})," for full purchase details and transaction info:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"// Get detailed purchase objects with full transaction info\nfinal purchases = await iap.getAvailablePurchases(\n  onlyIncludeActiveItemsIOS: true,\n);\n\nfor (final purchase in purchases) {\n  print('Product: ${purchase.productId}');\n  print('Purchase token: ${purchase.purchaseToken}');\n  print('Transaction date: ${purchase.transactionDate}');\n  print('Transaction ID: ${purchase.transactionId}');\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"get-purchase-history-ios",children:"Get Purchase History (iOS)"}),"\n",(0,s.jsx)(n.p,{children:"Include expired subscriptions on iOS:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"// Get all purchases including expired subscriptions (iOS only)\nfinal allPurchases = await iap.getAvailablePurchases(\n  onlyIncludeActiveItemsIOS: false,\n  alsoPublishToEventListenerIOS: false,\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"handle-subscription-purchase",children:"Handle Subscription Purchase"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"StreamSubscription<Purchase>? _purchaseSubscription;\n\nvoid setupListener() {\n  _purchaseSubscription = iap.purchaseUpdatedListener.listen(\n    (purchase) async {\n      // Check purchase state\n      bool isPurchased = false;\n\n      if (Platform.isAndroid && purchase is PurchaseAndroid) {\n        isPurchased = purchase.purchaseState == PurchaseState.purchased ||\n            purchase.androidPurchaseStateValue ==\n                AndroidPurchaseState.purchased.value;\n      } else if (purchase is PurchaseIOS) {\n        isPurchased = purchase.iosTransactionState ==\n            TransactionState.purchased;\n      }\n\n      if (isPurchased) {\n        // Validate on server\n        final isValid = await verifyPurchaseOnServer(purchase);\n        if (!isValid) return;\n\n        // Activate subscription\n        await activateSubscription(purchase.productId);\n\n        // Finish transaction\n        await iap.finishTransaction(\n          purchase: purchase,\n          isConsumable: false, // Subscriptions are non-consumable\n        );\n      }\n    },\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ios-promotional-offers",children:"iOS Promotional Offers"}),"\n",(0,s.jsx)(n.h3,{id:"check-eligibility",children:"Check Eligibility"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final isEligible = await iap.isEligibleForIntroOfferIOS(\n  groupID: 'subscription_group_id',\n);\n\nif (isEligible) {\n  // Show promotional price\n  print('Eligible for intro offer');\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"apply-promotional-offer",children:"Apply Promotional Offer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final requestProps = RequestPurchaseProps.subs((\n  ios: RequestSubscriptionIosProps(\n    sku: 'monthly_sub',\n    withOffer: DiscountOfferInputIOS(\n      identifier: 'promo_offer_id',\n      keyIdentifier: 'key_identifier',\n      nonce: nonceValue,\n      signature: signatureValue,\n      timestamp: timestampValue,\n    ),\n  ),\n  android: null,\n  useAlternativeBilling: null,\n));\n\nawait iap.requestPurchase(requestProps);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"handle-promotional-offer-upgrades",children:"Handle Promotional Offer Upgrades"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Related Issue"}),": ",(0,s.jsx)(n.a,{href:"https://github.com/hyochan/flutter_inapp_purchase/issues/578",children:"#578"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["When upgrading subscriptions using promotional offers (e.g., monthly \u2192 yearly), Apple StoreKit first emits a ",(0,s.jsx)(n.strong,{children:"renewal transaction"})," for the old subscription before creating the new one. This means ",(0,s.jsx)(n.code,{children:"purchaseUpdatedListener"})," may initially return the old product ID."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important"}),": Always check ",(0,s.jsx)(n.code,{children:"renewalInfo.autoRenewPreference"})," to get the actual subscribed product."]}),"\n",(0,s.jsx)(n.h4,{id:"example-upgrade-monthly-to-yearly-with-promo-offer",children:"Example: Upgrade Monthly to Yearly with Promo Offer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"StreamSubscription<Purchase>? _purchaseUpdatedSubscription;\n\n@override\nvoid initState() {\n  super.initState();\n  _setupPurchaseListener();\n}\n\nvoid _setupPurchaseListener() {\n  _purchaseUpdatedSubscription = iap.purchaseUpdatedListener.listen(\n    (purchase) async {\n      if (purchase.asIOS() case final ios?) {\n        await _handleIOSPurchase(ios);\n      }\n    },\n    onError: (error) {\n      print('Purchase error: $error');\n    },\n  );\n}\n\nFuture<void> _handleIOSPurchase(PurchaseIOS purchase) async {\n  final renewalInfo = purchase.renewalInfoIOS;\n\n  // \u2705 IMPORTANT: Get the effective product ID\n  final effectiveProductId = _getEffectiveProductId(purchase);\n\n  print('''\n  Purchase Update:\n  - Transaction productId: ${purchase.productId}\n  - Effective productId: $effectiveProductId\n  - Auto-renew preference: ${renewalInfo?.autoRenewPreference}\n  - Pending upgrade: ${renewalInfo?.pendingUpgradeProductId}\n  ''');\n\n  // Use effectiveProductId for your business logic\n  await activateSubscription(effectiveProductId);\n\n  // Finish the transaction\n  await iap.finishTransaction(purchase, isConsumable: false);\n}\n\nString _getEffectiveProductId(PurchaseIOS purchase) {\n  final renewalInfo = purchase.renewalInfoIOS;\n\n  // Priority 1: Check for pending upgrade\n  if (renewalInfo?.pendingUpgradeProductId != null) {\n    return renewalInfo!.pendingUpgradeProductId!;\n  }\n\n  // Priority 2: Use autoRenewPreference (the product that will renew)\n  if (renewalInfo?.autoRenewPreference != null) {\n    return renewalInfo!.autoRenewPreference!;\n  }\n\n  // Priority 3: Fall back to transaction productId\n  return purchase.productId;\n}\n\nFuture<void> purchasePromotionalOffer({\n  required String productId,\n  required String offerId,\n  required String keyId,\n  required String nonce,\n  required String signature,\n  required double timestamp,\n}) async {\n  try {\n    await iap.requestPurchase(\n      RequestPurchaseProps.subs((\n        android: null,\n        ios: RequestSubscriptionIosProps(\n          sku: productId,\n          appAccountToken: '',\n          withOffer: DiscountOfferInputIOS(\n            identifier: offerId,\n            keyIdentifier: keyId,\n            nonce: nonce,\n            signature: signature,\n            timestamp: timestamp,\n          ),\n        ),\n        useAlternativeBilling: null,\n      )),\n    );\n\n    // Note: purchaseUpdatedListener will handle the purchase\n    // and use _getEffectiveProductId() to get the correct product\n\n  } catch (error) {\n    print('Purchase failed: $error');\n    rethrow;\n  }\n}\n\n@override\nvoid dispose() {\n  _purchaseUpdatedSubscription?.cancel();\n  super.dispose();\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"alternative-reload-subscriptions-after-purchase",children:"Alternative: Reload Subscriptions After Purchase"}),"\n",(0,s.jsx)(n.p,{children:"You can also reload subscriptions to get the complete updated state:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"Future<void> purchasePromotionalOfferWithReload({\n  required String productId,\n  required String offerId,\n  required String keyId,\n  required String nonce,\n  required String signature,\n  required double timestamp,\n}) async {\n  try {\n    await iap.requestPurchase(\n      RequestPurchaseProps.subs((\n        android: null,\n        ios: RequestSubscriptionIosProps(\n          sku: productId,\n          appAccountToken: '',\n          withOffer: DiscountOfferInputIOS(\n            identifier: offerId,\n            keyIdentifier: keyId,\n            nonce: nonce,\n            signature: signature,\n            timestamp: timestamp,\n          ),\n        ),\n        useAlternativeBilling: null,\n      )),\n    );\n\n    // Wait for StoreKit to process\n    await Future.delayed(Duration(seconds: 2));\n\n    // Reload to get updated subscription state\n    final activeSubscriptions = await iap.getActiveSubscriptions(null);\n\n    if (activeSubscriptions.isNotEmpty) {\n      final subscription = activeSubscriptions.first;\n      print('Active subscription: ${subscription.productId}');\n      await activateSubscription(subscription.productId);\n    }\n\n  } catch (error) {\n    print('Purchase failed: $error');\n    rethrow;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"why-this-happens",children:"Why This Happens"}),"\n",(0,s.jsx)(n.p,{children:"During a promotional offer upgrade:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"User purchases yearly subscription (ProductIdv2) with promotional offer"}),"\n",(0,s.jsx)(n.li,{children:'StoreKit processes it as a "renewal with plan change"'}),"\n",(0,s.jsxs)(n.li,{children:["First emits the ",(0,s.jsx)(n.strong,{children:"existing monthly subscription's renewal"})," transaction (ProductIdv1)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"renewalInfo.autoRenewPreference"})," immediately reflects the new product (ProductIdv2)"]}),"\n",(0,s.jsx)(n.li,{children:"The actual new subscription transaction is created later (can take several minutes in sandbox)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This is Apple's normal behavior and is also acknowledged in the ",(0,s.jsx)(n.code,{children:"openiap"})," example app:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-swift",children:"// From openiap's SubscriptionFlowScreen.swift\n// Reload subscription state after upgrade/downgrade\n// (onPurchaseSuccess may fire with old subscription for upgrades)\nawait loadPurchases()\n"})}),"\n",(0,s.jsx)(n.h4,{id:"renewalinfo-fields",children:"RenewalInfo Fields"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Usage"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"autoRenewPreference"})}),(0,s.jsx)(n.td,{children:"The product ID that will renew next"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"Use this"})," as the effective product ID"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"pendingUpgradeProductId"})}),(0,s.jsx)(n.td,{children:"Set only when upgrade is pending and different from current"}),(0,s.jsx)(n.td,{children:"Indicates an upgrade in progress"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"willAutoRenew"})}),(0,s.jsx)(n.td,{children:"Whether subscription will auto-renew"}),(0,s.jsx)(n.td,{children:"Check if subscription is active"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"renewalDate"})}),(0,s.jsx)(n.td,{children:"When the next renewal will occur"}),(0,s.jsx)(n.td,{children:"Display to user"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"sandbox-testing-notes",children:"Sandbox Testing Notes"}),"\n",(0,s.jsx)(n.p,{children:"In sandbox environment:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Monthly subscriptions renew every 5 minutes"}),"\n",(0,s.jsx)(n.li,{children:"Yearly subscriptions renew every 1 hour"}),"\n",(0,s.jsx)(n.li,{children:"Transaction events may arrive with slight delays"}),"\n",(0,s.jsx)(n.li,{children:"Always wait for current subscription to expire before testing promotional offers"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"manage-subscriptions",children:"Manage Subscriptions"}),"\n",(0,s.jsx)(n.p,{children:"Open native subscription management UI:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"Future<void> manageSubscriptions() async {\n  if (Platform.isIOS) {\n    await iap.showManageSubscriptionsIOS();\n  } else if (Platform.isAndroid) {\n    await iap.deepLinkToSubscriptions(\n      skuAndroid: 'monthly_sub',\n    );\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"restore-purchases",children:"Restore Purchases"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"Future<void> restorePurchases() async {\n  // Get all available purchases\n  final purchases = await iap.getAvailablePurchases();\n\n  // Remove duplicates by productId, keeping most recent\n  final uniquePurchases = <String, Purchase>{};\n  for (final purchase in purchases) {\n    final existing = uniquePurchases[purchase.productId];\n    if (existing == null ||\n        purchase.transactionDate.compareTo(existing.transactionDate) > 0) {\n      uniquePurchases[purchase.productId] = purchase;\n    }\n  }\n\n  print('Restored ${uniquePurchases.length} unique purchase(s)');\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Server-side validation"})," - Always validate subscriptions on your backend"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Handle states properly"})," - Check both ",(0,s.jsx)(n.code,{children:"purchaseState"})," and platform-specific states"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Avoid duplicate processing"})," - Track processed transaction IDs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Test proration"})," - Test upgrade/downgrade flows thoroughly"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitor renewals"})," - Check subscription status regularly"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"../examples/subscription-flow",children:"Subscription Flow Example"})," for full implementation with:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Subscription purchase flow"}),"\n",(0,s.jsx)(n.li,{children:"Upgrade/downgrade handling"}),"\n",(0,s.jsx)(n.li,{children:"Proration mode selection"}),"\n",(0,s.jsx)(n.li,{children:"Active subscription checking"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./subscription-validation",children:"Subscription Validation"})," - Validate subscriptions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./error-handling",children:"Error Handling"})," - Handle subscription errors"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./offer-code-redemption",children:"Offer Code Redemption"})," - iOS offer codes"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);