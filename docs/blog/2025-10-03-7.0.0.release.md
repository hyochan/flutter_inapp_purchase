---
slug: 7.0.0-rc.1-release
title: Release 7.0.0-rc.1 - OpenIAP 1.0.10 Migration & Enhanced Type Safety
authors: [hyochan]
tags: [release, openiap, flutter, in-app-purchase, breaking-change]
date: 2025-10-03
---

Release 7.0.0-rc.1 migrates to OpenIAP GQL 1.0.11, introducing union types, platform-specific classes, and enhanced type safety. This release focuses on OpenIAP specification compliance while maintaining backward compatibility where possible.

[View the release on GitHub →](https://github.com/hyochan/flutter_inapp_purchase/releases/tag/7.0.0-rc.1)

<!-- truncate -->

## Highlights

### Migration

The biggest change in 7.0 is the migration to OpenIAP GQL 1.0.11, bringing a new type system that better represents platform-specific IAP features:

```dart
// Union types for Products
final result = await iap.fetchProducts(
  skus: ['product_id'],
  type: ProductQueryType.InApp,
);

if (result is FetchProductsResultProducts) {
  for (final product in result.value ?? []) {
    if (product is ProductIOS) {
      debugPrint('iOS Product: ${product.displayName}');
    } else if (product is ProductAndroid) {
      debugPrint('Android Product: ${product.title}');
    }
  }
}
```

This provides:

- **Better type safety**: Platform-specific properties are type-safe
- **Clearer intent**: Code explicitly handles platform differences
- **IDE support**: Better autocomplete and type hints
- **Runtime safety**: Union types prevent accessing wrong platform properties

### Platform-Specific Product Types

Products now use a union type system:

```dart
// In-app products
ProductIOS | ProductAndroid

// Subscription products
ProductSubscriptionIOS | ProductSubscriptionAndroid

// Purchases
PurchaseIOS | PurchaseAndroid
```

Each platform has its own specific properties:

```dart
if (product is ProductSubscriptionIOS) {
  // iOS-specific properties
  final offers = product.subscriptionOffers;
  final groupId = product.subscriptionGroupIdIOS;
} else if (product is ProductSubscriptionAndroid) {
  // Android-specific properties
  final offers = product.subscriptionOffers;
  final basePlanId = product.basePlanIdAndroid;
}
```

### Non-Nullable Event Streams

Event streams are now non-nullable for better null safety:

```dart
// Before (v6.x)
Stream<Purchase?> get purchaseUpdated
Stream<PurchaseResult?> get purchaseError

// After (v7.0)
Stream<Purchase> get purchaseUpdatedListener
Stream<PurchaseError> get purchaseErrorListener
```

Benefits:

- **No null checks**: Guaranteed to receive valid events
- **Clearer naming**: `Listener` suffix indicates event stream
- **Type safety**: Removes unnecessary optional handling

### Alternative Billing Support

Added support for Android's alternative billing:

```dart
await iap.initConnection(
  alternativeBillingModeAndroid: AlternativeBillingModeAndroid.UserChoice,
);
```

Modes:

- `None` - Standard Google Play billing only
- `UserChoice` - User can choose between Google Play or alternative billing
- `AlternativeOnly` - Skip Google Play billing entirely

### Android Replacement Modes

Subscription upgrade/downgrade now uses replacement modes instead of proration modes:

```dart
await iap.requestPurchase(
  RequestPurchaseProps.subs((
    ios: RequestSubscriptionIosProps(sku: 'yearly_sub'),
    android: RequestSubscriptionAndroidProps(
      skus: ['yearly_sub'],
      replacementModeAndroid: AndroidReplacementMode.withTimeProration,
    ),
    useAlternativeBilling: null,
  )),
);
```

Available modes:

- `withTimeProration` (1) - Credit unused time towards new subscription
- `chargeProratedPrice` (2) - Charge prorated price immediately
- `withoutProration` (3) - No credit for unused time
- `deferred` (4) - New subscription starts at next renewal
- `chargeFullPrice` (5) - Charge full price immediately

## Breaking Changes

### Removed Methods

The following deprecated iOS-specific methods have been removed:

- `getAvailableItemsIOS()` → Use `getAvailablePurchases()` instead
- `getAppTransactionTypedIOS()` → Use `getAppTransactionIOS()` instead
- `getPurchaseHistoriesIOS()` → Use `getAvailablePurchases(onlyIncludeActiveItemsIOS: false)` instead

### API Changes

- **Event streams renamed**: `purchaseUpdated` → `purchaseUpdatedListener`, `purchaseError` → `purchaseErrorListener`
- **Union types required**: Handle `FetchProductsResultProducts | FetchProductsResultError` explicitly
- **Platform-specific types**: Products and Purchases are now platform-specific classes
- **Non-nullable streams**: Event streams no longer emit nullable values

## Migration Guide

### 1. Update Event Listeners

```dart
// Before
iap.purchaseUpdated.listen((purchase) {
  if (purchase != null) {
    handlePurchase(purchase);
  }
});

// After
iap.purchaseUpdatedListener.listen((purchase) {
  handlePurchase(purchase); // No null check needed
});
```

### 2. Handle Union Types

```dart
// Before
final products = await iap.fetchProducts(...);
for (final product in products) {
  print(product.title);
}

// After
final result = await iap.fetchProducts(...);
if (result is FetchProductsResultProducts) {
  for (final product in result.value ?? []) {
    if (product is ProductIOS) {
      print(product.displayName);
    } else if (product is ProductAndroid) {
      print(product.title);
    }
  }
}
```

### 3. Update Replacement Modes

```dart
// Before
RequestPurchaseAndroidProps(
  prorationModeAndroid: 1,
)

// After
RequestPurchaseAndroidProps(
  replacementModeAndroid: AndroidReplacementMode.withTimeProration,
)
```

### 4. Replace Removed Methods

```dart
// Before
final items = await iap.getAvailableItemsIOS();

// After
final items = await iap.getAvailablePurchases();
```

## Benefits

### Type Safety

The new union type system provides compile-time safety:

- Platform-specific properties are type-safe
- No runtime errors from accessing wrong properties
- Better IDE autocomplete and warnings

### OpenIAP Compliance

Aligns with OpenIAP specification across multiple platforms:

- Expo IAP
- Flutter In-App Purchase
- Kotlin Multiplatform SDK
- React Native IAP (planned)

### Better Developer Experience

- **Clearer code**: Platform differences are explicit
- **Fewer bugs**: Type system catches errors at compile time
- **Better tooling**: IDEs provide accurate suggestions
- **Self-documenting**: Code intent is clear from types

## Resources

- [API Documentation](/docs/api/overview)
- [Type Reference](/docs/api/types)
- [Migration Guide](/docs/migration/from-v6)
- [Complete Examples](/docs/examples/purchase-flow)
- [GitHub Release](https://github.com/hyochan/flutter_inapp_purchase/releases/tag/7.0.0-rc.1)

## Acknowledgments

Thanks to all contributors and the OpenIAP community for feedback and testing. Special thanks to early adopters who helped identify issues during the RC phase.

Ready to upgrade? Check out our updated [documentation](/docs/api/overview) and [examples](/docs/examples/purchase-flow)!
